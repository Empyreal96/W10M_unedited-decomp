// sub_7FF730 
 
// positive sp value has been detected, the output may be wrong!
void __fastcall sub_7FF730(int a1, int a2, int a3, int a4, int a5, int a6, int a7, int a8, int a9, int a10, int a11, int a12, int a13, int a14, int a15, int a16, int a17, int a18, int a19, int *a20)
{
  unsigned int *v20; // r5
  int v21; // r1
  int v22; // r0
  int v23; // r1
  int v24; // r6
  unsigned int v25; // r0
  int v26; // r9
  int v27; // r7
  int (__fastcall *v28)(int, int, int, char, int, int, unsigned __int16 *, int, int, int *); // r6
  unsigned int v29; // r9
  unsigned __int16 *v30; // lr
  unsigned int v31; // r7
  unsigned int v32; // r6
  unsigned int v33; // r2
  unsigned int v34; // t1
  int v35; // r6
  int v36; // r7
  int v37; // r6
  _DWORD *v38; // r8
  int v39; // r3
  unsigned int *v40; // r5
  int v41; // r0
  int v42; // r4
  unsigned int v43; // r2
  int v44; // r0
  int v45; // r3
  _DWORD *v46; // r7
  int v47; // r10
  unsigned int *v48; // r4
  int v49; // r1
  unsigned int v50; // r0
  unsigned int v51; // r2
  int v52; // r0
  int v53; // r0
  int v54; // r3
  _DWORD *v55; // r7
  int v56; // r4
  unsigned int v57; // r6
  _DWORD *v58; // r0
  unsigned int v59; // r9
  char *v60; // lr
  int v61; // r5
  unsigned int *v62; // r4
  int v63; // r1
  unsigned int v64; // r0
  unsigned int v65; // r2
  int v66; // r0
  int v67; // r0
  int v68; // r0
  bool v69; // zf
  int v70; // r3
  int (__fastcall *v71)(int, int, int, char, int, int, unsigned __int16 *, int, int, int *); // r1
  int v72; // r0
  int v73; // r0
  int v74; // r0
  int *v75; // r0
  int v76; // r4
  int v77; // t1
  int v78; // t1
  unsigned int *v79; // r5
  int v80; // r1
  unsigned int v81; // r0
  unsigned int v82; // r2
  int v83; // r0
  int v84; // r0
  __int16 v85; // r2
  int v86; // r3
  unsigned int *v87; // r6
  int v88; // r0
  int v89; // r5
  unsigned int v90; // r2
  int v91; // r6
  int v92; // r1
  int v93; // r7
  int v94; // r4
  unsigned int v95; // r6
  int v96; // r4
  int v97; // r3
  int *v98; // r0
  int *v99; // r6
  int v100; // r1
  int v102; // r3
  int v103; // r0
  int v104; // r0
  unsigned __int64 v105; // kr38_8
  char v106; // r4
  int v107; // r5
  __int16 v108; // r6
  unsigned __int16 *v109; // r9
  int v110; // r10
  int v111; // r7
  unsigned int v112; // r1
  int v113; // r2
  _WORD *v114; // r4
  int v115; // r5
  int v116; // lr
  unsigned int v117; // r2
  unsigned __int8 *v118; // r5
  int v119; // r0
  int v120; // r4
  unsigned int v121; // r2
  int v122; // r0
  int v123; // r3
  unsigned int v124; // r2
  unsigned int *v125; // r5
  int v126; // r0
  int v127; // r4
  unsigned int v128; // r2
  int v129; // r0
  int v130; // r3
  unsigned int v131; // r0
  unsigned int v132; // r6
  int v133; // r4
  int v134; // r6
  int *v135; // r4
  int v136; // r1
  unsigned int v137; // r0
  unsigned int v138; // r2
  int v139; // r0
  int v140; // r0
  unsigned int v141; // r1
  int v142; // r3
  int v143; // r3
  unsigned int v144; // r2
  int v145; // r7
  unsigned __int8 *v146; // r6
  int v147; // r0
  int v148; // r4
  unsigned int v149; // r2
  unsigned int v150; // r2
  unsigned int v151; // r2
  int v152; // r4
  int *v153; // r5
  int v154; // r1
  unsigned int v155; // r0
  unsigned int v156; // r2
  int v157; // r0
  unsigned int v158; // r1
  __int16 v159; // r3
  int v160; // r1
  unsigned int v161; // r0
  unsigned int v162; // r2
  int v163; // r0
  unsigned int v164; // r1
  __int16 v165; // r3
  int *v166; // r4
  int v167; // r1
  unsigned int v168; // r0
  unsigned int v169; // r2
  int v170; // r0
  int v171; // r0
  unsigned int v172; // r1
  int v173; // r3
  int v174; // r3
  int v175; // r5
  unsigned int v176; // r0
  int *v177; // r5
  int v178; // r1
  unsigned int v179; // r0
  unsigned int v180; // r2
  int v181; // r0
  int v182; // r0
  int *v185; // [sp-90h] [bp-90h]
  int v186; // [sp-8Ch] [bp-8Ch]
  int v187; // [sp-88h] [bp-88h]
  unsigned __int64 v188; // [sp-84h] [bp-84h] BYREF
  int v189; // [sp-7Ch] [bp-7Ch]
  int v190; // [sp-78h] [bp-78h] BYREF
  int v191; // [sp-74h] [bp-74h]
  int v192; // [sp-70h] [bp-70h]
  int v193; // [sp-6Ch] [bp-6Ch] BYREF
  int v194; // [sp-68h] [bp-68h]
  int v195; // [sp-64h] [bp-64h] BYREF
  int *v196; // [sp-60h] [bp-60h]
  _WORD *v197; // [sp-5Ch] [bp-5Ch]
  unsigned int v198; // [sp-58h] [bp-58h]
  int v199; // [sp-54h] [bp-54h]
  int v200; // [sp-50h] [bp-50h]
  char v201; // [sp-4Ch] [bp-4Ch]
  int v202; // [sp-48h] [bp-48h]
  _DWORD v203[2]; // [sp-44h] [bp-44h] BYREF
  int v204; // [sp-3Ch] [bp-3Ch] BYREF
  int v205; // [sp-38h] [bp-38h]
  int v206; // [sp-34h] [bp-34h]
  int v207; // [sp-30h] [bp-30h] BYREF
  int v208; // [sp-2Ch] [bp-2Ch]
  unsigned __int16 *v209; // [sp-28h] [bp-28h]
  _DWORD *v210; // [sp-24h] [bp-24h]
  int v211; // [sp-20h] [bp-20h] BYREF
  int v212; // [sp-14h] [bp-14h]
  unsigned __int16 *v213; // [sp-10h] [bp-10h]
  int v214; // [sp-Ch] [bp-Ch]

  if ( v107 )
  {
    v104 = ObReferenceObjectByHandle(v107, 0, 0, v106, (int)&v195, a1);
    v111 = v195;
    v193 = v104;
    v186 = v195;
    if ( v104 < 0 )
      goto LABEL_267;
    if ( !*v109
      || **((_WORD **)v109 + 1) != 92
      || (void *)ObTypeIndexTable[*(unsigned __int8 *)(v195 - 12) ^ (unsigned __int8)((unsigned __int16)(v195 - 24) >> 8) ^ (unsigned __int8)ObHeaderCookie] == IoFileObjectType )
    {
      if ( !*v109
        && ObTypeIndexTable[*(unsigned __int8 *)(v195 - 12) ^ (unsigned __int8)((unsigned __int16)(v195 - 24) >> 8) ^ (unsigned __int8)ObHeaderCookie] == ObpDirectoryObjectType )
      {
        if ( ObReferenceObjectByPointer(v195, 0, v192, v201) >= 0 )
          v190 = v111;
        ObfDereferenceObject(v111);
        *a20 = v190;
        goto LABEL_267;
      }
      v105 = *(_QWORD *)v109;
      v190 = v195;
      v213 = v109;
      v214 = v107;
      v188 = v105;
      v212 = v192 + 8;
      SeSetLearningModeObjectInformation();
      v116 = v190;
      v114 = (_WORD *)HIDWORD(v105);
      v26 = v105;
      goto LABEL_150;
    }
  }
  else
  {
    if ( PsGetSiloObject(-1, (int)&ObpDirectoryObjectType, (int)&v195, a4) < 0 )
    {
      v111 = ObpRootDirectoryObject;
      v186 = ObpRootDirectoryObject;
      if ( ObpRootDirectoryObject )
        ObfReferenceObject(ObpRootDirectoryObject);
    }
    else
    {
      v111 = v195;
      v186 = v195;
    }
    if ( *v109 && **((_WORD **)v109 + 1) == 92 )
    {
      if ( *v109 == 2 )
      {
        if ( v111 )
        {
          if ( ObReferenceObjectByPointer(v111, 0, v192, v106) >= 0 )
            *a20 = v111;
          ObfDereferenceObject(v111);
        }
        else if ( a17 && ObReferenceObjectByPointer(a17, 0, v192, v106) >= 0 )
        {
          *a20 = a17;
          __asm { POP.W           {R4-R11,PC} }
        }
        goto LABEL_267;
      }
      v213 = v109;
      v212 = v192 + 8;
      v214 = 0;
      SeSetLearningModeObjectInformation();
LABEL_145:
      v23 = *((_DWORD *)v109 + 1);
      if ( (v23 & 7) == 0 )
      {
        v24 = (v108 & 0x800) != 0;
        v25 = *v109;
        if ( v25 >= 8 && *(_QWORD *)v23 == *(_QWORD *)ObpDosDevicesShortNamePrefix )
        {
          v75 = (int *)ObpReferenceDeviceMap(v24, v23, *(_DWORD *)v23, *(int *)ObpDosDevicesShortNamePrefix);
          v196 = v75;
          if ( v75 && *v75 )
          {
            v76 = *((_DWORD *)v109 + 1);
            LODWORD(v188) = *(_DWORD *)v109;
            v114 = (_WORD *)(v76 + 8);
            v115 = (unsigned __int16)(v188 - 8);
            LOWORD(v188) = v188 - 8;
            HIDWORD(v188) = v114;
            v116 = *v75;
            v26 = v188;
            v190 = *v75;
            goto LABEL_151;
          }
        }
        else if ( v25 == 6 && *(_DWORD *)v23 == *(_DWORD *)L"\\??" )
        {
          v97 = *(unsigned __int16 *)(v23 + 4);
          if ( v97 == (unsigned __int16)ObpDosDevicesShortNameRoot[2] )
          {
            v98 = (int *)ObpReferenceDeviceMap(v24, v23, (unsigned __int16)ObpDosDevicesShortNameRoot[2], v97);
            v99 = v98;
            v196 = v98;
            if ( v98 )
            {
              if ( *v98 )
              {
                if ( ObReferenceObjectByPointer(*v98, 0, v192, v201) >= 0 )
                {
                  v102 = *v99;
                  *a20 = *v99;
                }
                ObfDereferenceDeviceMap((int)v99, v100, (int)a20, v102);
                v103 = ObfDereferenceObject(v111);
                SeClearLearningModeObjectInformation(v103);
                __asm { POP.W           {R4-R11,PC} }
              }
            }
          }
        }
      }
      v26 = *(_DWORD *)v109;
      v114 = (_WORD *)*((_DWORD *)v209 + 1);
      v188 = __PAIR64__((unsigned int)v114, v26);
      v116 = v111;
      v190 = v111;
LABEL_150:
      v115 = (unsigned __int16)v188;
LABEL_151:
      v191 = v116;
      while ( 1 )
      {
        v189 = v26;
        do
        {
          v27 = v116 - 24;
          v113 = (unsigned __int8)((unsigned __int16)(v116 - 24) >> 8) ^ (unsigned __int8)ObHeaderCookie ^ *(unsigned __int8 *)(v116 - 12);
          v112 = ObTypeIndexTable[v113];
          v28 = *(int (__fastcall **)(int, int, int, char, int, int, unsigned __int16 *, int, int, int *))(v112 + 104);
          if ( v28 )
          {
            if ( v28 != ObpParseSymbolicLink )
            {
              if ( a17 )
              {
LABEL_116:
                v133 = -1073741788;
                goto LABEL_278;
              }
              ObfReferenceObject(v116);
              if ( *(_BYTE *)(v110 + 18) )
              {
                v135 = (int *)(*(_DWORD *)v110 + 148);
                __pld(v135);
                v136 = *v135;
                if ( (*v135 & 0xFFFFFFF0) <= 0x10 )
                  v137 = 0;
                else
                  v137 = v136 - 16;
                if ( (v136 & 2) != 0 )
                  goto LABEL_41;
                __dmb(0xBu);
                do
                  v138 = __ldrex((unsigned int *)v135);
                while ( v138 == v136 && __strex(v137, (unsigned int *)v135) );
                if ( v138 != v136 )
LABEL_41:
                  ExfReleasePushLock(v135, v136);
                KeAbPostRelease((unsigned int)v135);
                v139 = *(_DWORD *)v110;
                *(_DWORD *)(v110 + 20) = -286387660;
                v140 = ObfDereferenceObject(v139);
                *(_DWORD *)v110 = 0;
                *(_BYTE *)(v110 + 18) = 0;
                *(_BYTE *)(v110 + 19) = 0;
                v141 = __mrc(15, 0, 13, 0, 3) & 0xFFFFFFC0;
                v142 = (__int16)(*(_WORD *)(v141 + 0x134) + 1);
                *(_WORD *)(v141 + 308) = v142;
                if ( !v142 && *(_DWORD *)(v141 + 100) != v141 + 100 && !*(_WORD *)(v141 + 310) )
                  KiCheckForKernelApcDelivery(v140);
              }
              v72 = *(_DWORD *)(v110 + 4);
              if ( v72 )
              {
                ObfDereferenceObject(v72);
                *(_DWORD *)(v110 + 4) = 0;
              }
              v116 = v190;
            }
            v185 = &v190;
            v109 = v209;
            v133 = ((int (__fastcall *)(int, int, int, int, int, unsigned __int16 *, unsigned __int64 *))v28)(
                     v116,
                     v192,
                     a18,
                     v199,
                     v194,
                     v209,
                     &v188);
            v193 = v133;
            if ( v28 != ObpParseSymbolicLink )
              ObfDereferenceObject(v27 + 24);
            if ( v133 == 260 )
            {
              v134 = v186;
            }
            else
            {
              if ( v133 != 872 )
              {
                if ( v133 >= 0 )
                {
                  v174 = v190;
                  if ( !v190 )
                    goto LABEL_277;
LABEL_257:
                  if ( v133 >= 0 )
                    goto LABEL_258;
                }
                goto LABEL_278;
              }
              v134 = v186;
              if ( v186 != ObpRootDirectoryObject )
              {
                ObfDereferenceObject(v186);
                v134 = ObpRootDirectoryObject;
                ObfReferenceObject(ObpRootDirectoryObject);
              }
            }
            if ( !--v206 )
            {
              v133 = -1073741772;
              goto LABEL_279;
            }
            if ( !*v109 || **((_WORD **)v109 + 1) != 92 )
            {
              v133 = -1073741773;
              goto LABEL_279;
            }
            ObfDereferenceObject(v134);
            if ( ObTypeIndexTable[*(unsigned __int8 *)(v27 + 12) ^ BYTE1(v27) ^ (unsigned __int8)ObHeaderCookie] == ObpSymbolicLinkObjectType )
            {
              v143 = *(_DWORD *)(v190 + 20);
              if ( (v143 & 1) != 0 )
              {
                v111 = ObpRootDirectoryObject;
                v186 = ObpRootDirectoryObject;
                ObfReferenceObject(ObpRootDirectoryObject);
                goto LABEL_134;
              }
              if ( PsGetSiloObject(-1, (int)&ObpDirectoryObjectType, (int)&v207, v143) >= 0 )
              {
                v111 = v207;
                goto LABEL_53;
              }
              v111 = ObpRootDirectoryObject;
              v186 = ObpRootDirectoryObject;
              v207 = ObpRootDirectoryObject;
              if ( !ObpRootDirectoryObject )
              {
LABEL_134:
                if ( v196 )
                {
                  v20 = (unsigned int *)(v196 + 3);
                  v21 = v196[3];
                  if ( v21 == 1 )
                  {
LABEL_57:
                    PsGetMonitorContextServerSilo(ObSiloMonitor, -1, &v211);
                    v144 = __mrc(15, 0, 13, 0, 3) & 0xFFFFFFC0;
                    --*(_WORD *)(v144 + 310);
                    v145 = v211;
                    v146 = (unsigned __int8 *)(v211 + 112);
                    v147 = KeAbPreAcquire(v211 + 112, 0, 0);
                    v148 = v147;
                    do
                      v149 = __ldrex(v146);
                    while ( __strex(v149 | 1, v146) );
                    __dmb(0xBu);
                    if ( (v149 & 1) != 0 )
                      ExfAcquirePushLockExclusiveEx(v146, v147, (unsigned int)v146);
                    if ( v148 )
                      *(_BYTE *)(v148 + 14) |= 1u;
                    __dmb(0xBu);
                    do
                    {
                      v150 = __ldrex(v20);
                      v151 = v150 - 1;
                    }
                    while ( __strex(v151, v20) );
                    __dmb(0xBu);
                    v152 = v151 + 1;
                    __pld(v146);
                    if ( v151 )
                    {
                      v160 = *(_DWORD *)v146;
                      if ( (*(_DWORD *)v146 & 0xFFFFFFF0) <= 0x10 )
                        v161 = 0;
                      else
                        v161 = v160 - 16;
                      if ( (v160 & 2) != 0 )
                        goto LABEL_87;
                      __dmb(0xBu);
                      do
                        v162 = __ldrex((unsigned int *)v146);
                      while ( v162 == v160 && __strex(v161, (unsigned int *)v146) );
                      if ( v162 != v160 )
LABEL_87:
                        ExfReleasePushLock(v146, v160);
                      v163 = KeAbPostRelease((unsigned int)v146);
                      v164 = __mrc(15, 0, 13, 0, 3) & 0xFFFFFFC0;
                      v165 = *(_WORD *)(v164 + 0x136) + 1;
                      *(_WORD *)(v164 + 310) = v165;
                      if ( !v165 && *(_DWORD *)(v164 + 100) != v164 + 100 )
                        KiCheckForKernelApcDelivery(v163);
                    }
                    else
                    {
                      v153 = v196;
                      *(_DWORD *)(*v196 + 152) = 0;
                      v154 = *(_DWORD *)v146;
                      if ( (*(_DWORD *)v146 & 0xFFFFFFF0) <= 0x10 )
                        v155 = 0;
                      else
                        v155 = v154 - 16;
                      if ( (v154 & 2) != 0 )
                        goto LABEL_74;
                      __dmb(0xBu);
                      do
                        v156 = __ldrex((unsigned int *)v146);
                      while ( v156 == v154 && __strex(v155, (unsigned int *)v146) );
                      if ( v156 != v154 )
LABEL_74:
                        ExfReleasePushLock(v146, v154);
                      v157 = KeAbPostRelease((unsigned int)v146);
                      v158 = __mrc(15, 0, 13, 0, 3) & 0xFFFFFFC0;
                      v159 = *(_WORD *)(v158 + 0x136) + 1;
                      *(_WORD *)(v158 + 310) = v159;
                      if ( !v159 && *(_DWORD *)(v158 + 100) != v158 + 100 )
                        KiCheckForKernelApcDelivery(v157);
                      ZwClose();
                      ObfDereferenceObject(*v153);
                      ExFreePoolWithTag((unsigned int)v153);
                    }
                    if ( v145 )
                      PsDereferenceMonitorContextServerSilo(v145);
                    v111 = v186;
                  }
                  else
                  {
                    while ( 1 )
                    {
                      __dmb(0xBu);
                      do
                        v152 = __ldrex(v20);
                      while ( v152 == v21 && __strex(v21 - 1, v20) );
                      __dmb(0xBu);
                      if ( v152 == v21 )
                        break;
                      v21 = v152;
                      if ( v152 == 1 )
                        goto LABEL_57;
                    }
                  }
                  if ( v152 <= 0 )
                    __fastfail(0xEu);
                  v196 = 0;
                }
                if ( *(_BYTE *)(v110 + 18) )
                {
                  v166 = (int *)(*(_DWORD *)v110 + 148);
                  __pld(v166);
                  v167 = *v166;
                  if ( (*v166 & 0xFFFFFFF0) <= 0x10 )
                    v168 = 0;
                  else
                    v168 = v167 - 16;
                  if ( (v167 & 2) != 0 )
                    goto LABEL_102;
                  __dmb(0xBu);
                  do
                    v169 = __ldrex((unsigned int *)v166);
                  while ( v169 == v167 && __strex(v168, (unsigned int *)v166) );
                  if ( v169 != v167 )
LABEL_102:
                    ExfReleasePushLock(v166, v167);
                  KeAbPostRelease((unsigned int)v166);
                  v170 = *(_DWORD *)v110;
                  *(_DWORD *)(v110 + 20) = -286387660;
                  v171 = ObfDereferenceObject(v170);
                  *(_DWORD *)v110 = 0;
                  *(_BYTE *)(v110 + 18) = 0;
                  *(_BYTE *)(v110 + 19) = 0;
                  v172 = __mrc(15, 0, 13, 0, 3) & 0xFFFFFFC0;
                  v173 = (__int16)(*(_WORD *)(v172 + 0x134) + 1);
                  *(_WORD *)(v172 + 308) = v173;
                  if ( !v173 && *(_DWORD *)(v172 + 100) != v172 + 100 && !*(_WORD *)(v172 + 310) )
                    KiCheckForKernelApcDelivery(v171);
                }
                v22 = *(_DWORD *)(v110 + 4);
                v108 = v194;
                if ( v22 )
                {
                  ObfDereferenceObject(v22);
                  v108 = v194;
                  *(_DWORD *)(v110 + 4) = 0;
                }
                goto LABEL_145;
              }
            }
            else
            {
              if ( PsGetSiloObject(-1, (int)&ObpDirectoryObjectType, (int)&v204, ObpSymbolicLinkObjectType) >= 0 )
              {
                v111 = v204;
LABEL_53:
                v186 = v111;
                goto LABEL_134;
              }
              v111 = ObpRootDirectoryObject;
              v186 = ObpRootDirectoryObject;
              v204 = ObpRootDirectoryObject;
              if ( !ObpRootDirectoryObject )
                goto LABEL_134;
            }
            ObfReferenceObject(ObpRootDirectoryObject);
            goto LABEL_134;
          }
          if ( v112 != ObpDirectoryObjectType )
            goto LABEL_116;
          v195 = v116;
          if ( v115 && *v114 == 92 )
          {
            v115 = (unsigned __int16)(v115 - 2);
            LOWORD(v188) = v115;
            v26 = v188;
            HIDWORD(v188) = ++v114;
            v189 = v188;
          }
          v113 = (int)v114;
          v197 = v114;
          v203[0] = v26;
          v203[1] = v114;
          if ( v115 )
          {
            do
            {
              if ( *v114 == 92 )
                break;
              v115 = (unsigned __int16)(v115 - 2);
              ++v114;
              LOWORD(v188) = v115;
              HIDWORD(v188) = v114;
            }
            while ( v115 );
            v189 = v188;
          }
          v29 = (unsigned __int16)(LOWORD(v203[0]) - v115);
          v198 = v29;
          LOWORD(v203[0]) -= v115;
          if ( !LOWORD(v203[0]) )
          {
            v133 = -1073741773;
            goto LABEL_278;
          }
          if ( !v115 )
            goto LABEL_268;
          if ( v199 && (*(_DWORD *)(a18 + 12) & 1) == 0 )
          {
            if ( !((int (__fastcall *)(int))ObpCheckTraverseAccess)(v116) )
            {
LABEL_31:
              v133 = v193;
              v134 = v186;
              if ( v193 >= 0 )
                v133 = -1073741772;
              goto LABEL_279;
            }
            v114 = (_WORD *)HIDWORD(v188);
            v115 = (unsigned __int16)v188;
            v116 = v191;
            v113 = (int)v197;
            v189 = v188;
          }
          if ( !v115 )
          {
LABEL_268:
            ObfReferenceObject(v116);
            v200 = v191;
            if ( !a17 )
            {
              *(_DWORD *)(v110 + 20) = -1145368012;
              v124 = __mrc(15, 0, 13, 0, 3) & 0xFFFFFFC0;
              --*(_WORD *)(v124 + 308);
              v125 = (unsigned int *)(v191 + 148);
              v126 = KeAbPreAcquire(v191 + 148, 0, 0);
              v127 = v126;
              do
                v128 = __ldrex(v125);
              while ( !v128 && __strex(0x11u, v125) );
              __dmb(0xBu);
              if ( v128 )
                ExfAcquirePushLockSharedEx((_DWORD *)(v191 + 148), v126, v191 + 148);
              if ( v127 )
                *(_BYTE *)(v127 + 14) |= 1u;
              v129 = v191;
              *(_DWORD *)(v110 + 20) = -572714444;
              ObfReferenceObject(v129);
              *(_BYTE *)(v110 + 18) = 1;
              v116 = v191;
              *(_BYTE *)(v110 + 19) = 0;
              v114 = (_WORD *)HIDWORD(v188);
              v130 = v188;
              v115 = (unsigned __int16)v188;
              *(_DWORD *)v110 = v116;
              v189 = v130;
              goto LABEL_168;
            }
            *(_DWORD *)(v110 + 20) = -1431694796;
            v117 = __mrc(15, 0, 13, 0, 3) & 0xFFFFFFC0;
            --*(_WORD *)(v117 + 308);
            v118 = (unsigned __int8 *)(v191 + 148);
            v119 = KeAbPreAcquire(v191 + 148, 0, 0);
            v120 = v119;
            do
              v121 = __ldrex(v118);
            while ( __strex(v121 | 1, v118) );
            __dmb(0xBu);
            if ( (v121 & 1) != 0 )
              ExfAcquirePushLockExclusiveEx((_DWORD *)(v191 + 148), v119, v191 + 148);
            if ( v120 )
              *(_BYTE *)(v120 + 14) |= 1u;
            v122 = v191;
            *(_DWORD *)(v110 + 20) = -859041228;
            ObfReferenceObject(v122);
            v116 = v191;
            v114 = (_WORD *)HIDWORD(v188);
            v123 = v188;
            v115 = (unsigned __int16)v188;
            v113 = (int)v197;
            *(_DWORD *)v110 = v191;
            *(_BYTE *)(v110 + 18) = 1;
            *(_BYTE *)(v110 + 19) = 1;
            v189 = v123;
          }
          if ( a17 )
          {
            v205 = 0;
            goto LABEL_169;
          }
LABEL_168:
          v205 = 1;
          v113 = (int)v197;
LABEL_169:
          v210 = (_DWORD *)v116;
          v202 = (v194 & 0x40) != 0;
          v30 = (unsigned __int16 *)v113;
          v31 = v29 >> 1;
          v32 = 0;
          if ( v29 >> 1 )
          {
            do
            {
              v34 = *v30++;
              v33 = v34;
              --v31;
              v35 = 3 * v32 + (v32 >> 1);
              if ( v34 >= 0x61 )
              {
                if ( v33 > 0x7A )
                  v32 = v35
                      + (unsigned __int16)(*(_WORD *)(Nls844UnicodeUpcaseTable
                                                    + 2
                                                    * (*(unsigned __int16 *)(Nls844UnicodeUpcaseTable
                                                                           + 2
                                                                           * (*(unsigned __int16 *)(Nls844UnicodeUpcaseTable
                                                                                                  + 2 * (v33 >> 8))
                                                                            + ((unsigned __int8)v33 >> 4)))
                                                     + (v33 & 0xF)))
                                         + v33);
                else
                  v32 = v33 + v35 - 32;
              }
              else
              {
                v32 = v35 + v33;
              }
            }
            while ( v31 );
            v29 = v198;
          }
          v36 = v191;
          *(_DWORD *)(v110 + 12) = v32;
          v113 = v32 % 0x25;
          v37 = *(unsigned __int8 *)(v110 + 18);
          v112 = (unsigned __int16)v113;
          *(_WORD *)(v110 + 16) = v113;
          v208 = v37;
          v38 = (_DWORD *)(v36 + 4 * (unsigned __int16)v113);
          if ( !v37 )
          {
            *(_DWORD *)(v110 + 20) = -1145368012;
            v39 = __mrc(15, 0, 13, 0, 3);
            --*(_WORD *)((v39 & 0xFFFFFFC0) + 0x134);
            v40 = (unsigned int *)(v191 + 148);
            v41 = KeAbPreAcquire(v191 + 148, 0, 0);
            v42 = v41;
            do
              v43 = __ldrex(v40);
            while ( !v43 && __strex(0x11u, v40) );
            __dmb(0xBu);
            if ( v43 )
              ExfAcquirePushLockSharedEx((_DWORD *)(v191 + 148), v41, v191 + 148);
            if ( v42 )
              *(_BYTE *)(v42 + 14) |= 1u;
            v44 = v191;
            *(_DWORD *)(v110 + 20) = -572714444;
            ObfReferenceObject(v44);
            *(_BYTE *)(v110 + 18) = 1;
            *(_BYTE *)(v110 + 19) = 0;
            v114 = (_WORD *)HIDWORD(v188);
            v45 = v188;
            v115 = (unsigned __int16)v188;
            *(_DWORD *)v110 = v191;
            v189 = v45;
          }
          v46 = (_DWORD *)*v38;
          if ( !*v38 )
            goto LABEL_188;
          v47 = *(_DWORD *)(v110 + 12);
          while ( 1 )
          {
            if ( v46[2] != v47 )
              goto LABEL_186;
            v112 = (unsigned int)ObpInfoMaskToOffset;
            v57 = v29;
            v113 = v46[1] - 24 - ObpInfoMaskToOffset[*(_BYTE *)(v46[1] - 10) & 3];
            if ( v29 != *(unsigned __int16 *)(v113 + 4) )
              goto LABEL_186;
            v58 = *(_DWORD **)(v113 + 8);
            v112 = (unsigned int)v197;
            v59 = (unsigned int)v197 + v29;
            if ( v198 >= 4 )
            {
              do
              {
                v113 = *(_DWORD *)v112;
                if ( *(_DWORD *)v112 != *v58 )
                  break;
                v57 -= 4;
                if ( !v57 )
                  goto LABEL_224;
                v112 += 4;
                ++v58;
              }
              while ( v57 >= 4 );
            }
            if ( v202 )
            {
              if ( v112 >= v59 )
                break;
              v60 = (char *)v58 - v112;
              while ( 1 )
              {
                v131 = *(unsigned __int16 *)v112;
                v132 = *(unsigned __int16 *)&v60[v112];
                if ( v131 != v132 )
                {
                  if ( v131 >= 0x61 )
                  {
                    if ( v131 > 0x7A )
                    {
                      v113 = *(unsigned __int16 *)(Nls844UnicodeUpcaseTable
                                                 + 2
                                                 * (*(unsigned __int16 *)(Nls844UnicodeUpcaseTable + 2 * BYTE1(v131))
                                                  + ((unsigned __int8)v131 >> 4)))
                           + (v131 & 0xF);
                      v131 = (unsigned __int16)(*(_WORD *)(Nls844UnicodeUpcaseTable + 2 * v113) + v131);
                    }
                    else
                    {
                      v131 -= 32;
                    }
                  }
                  if ( v132 >= 0x61 )
                  {
                    if ( v132 > 0x7A )
                    {
                      v113 = *(unsigned __int16 *)(Nls844UnicodeUpcaseTable
                                                 + 2
                                                 * (*(unsigned __int16 *)(Nls844UnicodeUpcaseTable + 2 * BYTE1(v132))
                                                  + ((unsigned __int8)v132 >> 4)))
                           + (v132 & 0xF);
                      v132 = (unsigned __int16)(*(_WORD *)(Nls844UnicodeUpcaseTable + 2 * v113) + v132);
                    }
                    else
                    {
                      v132 -= 32;
                    }
                  }
                  if ( v131 != v132 )
                    goto LABEL_335;
                }
                v112 += 2;
                if ( v112 >= v59 )
                  goto LABEL_224;
              }
            }
            if ( v112 >= v59 )
              break;
            while ( 1 )
            {
              v77 = *(unsigned __int16 *)v58;
              v58 = (_DWORD *)((char *)v58 + 2);
              v113 = v77;
              v78 = *(unsigned __int16 *)v112;
              v112 += 2;
              if ( v78 != v113 )
                break;
              if ( v112 >= v59 )
                goto LABEL_224;
            }
LABEL_335:
            v29 = v198;
LABEL_186:
            v38 = v46;
            v46 = (_DWORD *)*v46;
            if ( !v46 )
            {
              v37 = v208;
              v110 = a19;
LABEL_188:
              if ( !v37 )
              {
                v48 = (unsigned int *)(v191 + 148);
                __pld((void *)(v191 + 148));
                v49 = *v48;
                if ( (*v48 & 0xFFFFFFF0) > 0x10 )
                  v50 = v49 - 16;
                else
                  v50 = 0;
                if ( (v49 & 2) != 0 )
                  goto LABEL_344;
                __dmb(0xBu);
                do
                  v51 = __ldrex(v48);
                while ( v51 == v49 && __strex(v50, v48) );
                if ( v51 != v49 )
LABEL_344:
                  ExfReleasePushLock(v48, v49);
                KeAbPostRelease((unsigned int)v48);
                v52 = *(_DWORD *)v110;
                *(_DWORD *)(v110 + 20) = -286387660;
                ObfDereferenceObject(v52);
                *(_DWORD *)v110 = 0;
                *(_BYTE *)(v110 + 18) = 0;
                *(_BYTE *)(v110 + 19) = 0;
                v53 = __mrc(15, 0, 13, 0, 3) & 0xFFFFFFC0;
                v113 = *(unsigned __int16 *)(v53 + 0x134);
                v112 = v113 + 1;
                *(_WORD *)(v53 + 308) = v113 + 1;
                if ( (_WORD)v113 == 0xFFFF )
                {
                  v113 = v53 + 100;
                  if ( *(_DWORD *)(v53 + 100) != v53 + 100 && !*(_WORD *)(v53 + 310) )
                    KiCheckForKernelApcDelivery(v53);
                }
                v114 = (_WORD *)HIDWORD(v188);
                v115 = (unsigned __int16)v188;
                v189 = v188;
              }
              v116 = 0;
              v191 = 0;
              goto LABEL_200;
            }
          }
LABEL_224:
          v61 = v46[1];
          ObfReferenceObject(v61);
          if ( v208 )
          {
            v110 = a19;
          }
          else
          {
            v62 = (unsigned int *)(v191 + 148);
            __pld((void *)(v191 + 148));
            v63 = *v62;
            if ( (*v62 & 0xFFFFFFF0) > 0x10 )
              v64 = v63 - 16;
            else
              v64 = 0;
            if ( (v63 & 2) != 0 )
              goto LABEL_336;
            __dmb(0xBu);
            do
              v65 = __ldrex(v62);
            while ( v65 == v63 && __strex(v64, v62) );
            if ( v65 != v63 )
LABEL_336:
              ExfReleasePushLock(v62, v63);
            KeAbPostRelease((unsigned int)v62);
            v110 = a19;
            v66 = *(_DWORD *)a19;
            *(_DWORD *)(a19 + 20) = -286387660;
            ObfDereferenceObject(v66);
            *(_DWORD *)a19 = 0;
            *(_BYTE *)(a19 + 18) = 0;
            *(_BYTE *)(a19 + 19) = 0;
            v67 = __mrc(15, 0, 13, 0, 3) & 0xFFFFFFC0;
            v113 = *(unsigned __int16 *)(v67 + 0x134);
            v112 = v113 + 1;
            *(_WORD *)(v67 + 308) = v113 + 1;
            if ( (_WORD)v113 == 0xFFFF )
            {
              v113 = v67 + 100;
              if ( *(_DWORD *)(v67 + 100) != v67 + 100 && !*(_WORD *)(v67 + 310) )
                KiCheckForKernelApcDelivery(v67);
            }
            v38 = 0;
          }
          v68 = *(_DWORD *)(v110 + 4);
          if ( v68 )
            ObfDereferenceObject(v68);
          v114 = (_WORD *)HIDWORD(v188);
          *(_DWORD *)(v110 + 4) = v61;
          *(_DWORD *)(v110 + 8) = v38;
          v116 = v61;
          v191 = v61;
          v69 = v61 == 0;
          v115 = (unsigned __int16)v188;
          if ( !v69 )
          {
LABEL_238:
            v26 = v188;
            v189 = v188;
            goto LABEL_239;
          }
          v189 = v188;
LABEL_200:
          v54 = v205;
          if ( v205 )
          {
            v55 = v210;
            do
            {
              v56 = ObpGetShadowDirectory(v55, v112, v113, v54);
              if ( v56 )
              {
                if ( *(_BYTE *)(v110 + 18) )
                {
                  ObfReferenceObject((int)v55);
                  v79 = v55 + 37;
                  __pld(v55 + 37);
                  v80 = v55[37];
                  if ( (v80 & 0xFFFFFFF0) > 0x10 )
                    v81 = v80 - 16;
                  else
                    v81 = 0;
                  if ( (v80 & 2) != 0 )
                    goto LABEL_29;
                  __dmb(0xBu);
                  do
                    v82 = __ldrex(v79);
                  while ( v82 == v80 && __strex(v81, v79) );
                  if ( v82 != v80 )
LABEL_29:
                    ExfReleasePushLock(v55 + 37, v80);
                  KeAbPostRelease((unsigned int)(v55 + 37));
                  v83 = *(_DWORD *)v110;
                  *(_DWORD *)(v110 + 20) = -286387660;
                  ObfDereferenceObject(v83);
                  *(_DWORD *)v110 = 0;
                  *(_BYTE *)(v110 + 18) = 0;
                  *(_BYTE *)(v110 + 19) = 0;
                  v84 = __mrc(15, 0, 13, 0, 3) & 0xFFFFFFC0;
                  v85 = *(_WORD *)(v84 + 0x134);
                  *(_WORD *)(v84 + 308) = v85 + 1;
                  if ( v85 == -1 && *(_DWORD *)(v84 + 100) != v84 + 100 && !*(_WORD *)(v84 + 310) )
                    KiCheckForKernelApcDelivery(v84);
                  *(_DWORD *)(v110 + 20) = -1145368012;
                  v86 = __mrc(15, 0, 13, 0, 3);
                  --*(_WORD *)((v86 & 0xFFFFFFC0) + 0x134);
                  v87 = (unsigned int *)(v56 + 148);
                  v88 = KeAbPreAcquire(v56 + 148, 0, 0);
                  v89 = v88;
                  do
                    v90 = __ldrex(v87);
                  while ( !v90 && __strex(0x11u, v87) );
                  __dmb(0xBu);
                  if ( v90 )
                    ExfAcquirePushLockSharedEx((_DWORD *)(v56 + 148), v88, v56 + 148);
                  if ( v89 )
                    *(_BYTE *)(v89 + 14) |= 1u;
                  *(_DWORD *)(v110 + 20) = -572714444;
                  ObfReferenceObject(v56);
                  *(_BYTE *)(v110 + 18) = 1;
                  *(_DWORD *)v110 = v56;
                  *(_BYTE *)(v110 + 19) = 0;
                  ObfDereferenceObject((int)v55);
                }
                v116 = ObpLookupDirectoryUsingHash(v56, (int)v203, v110, v202);
                v191 = v116;
              }
              else
              {
                v116 = v191;
              }
              v55 = (_DWORD *)v56;
            }
            while ( !v116 && v56 );
            v114 = (_WORD *)HIDWORD(v188);
            v115 = (unsigned __int16)v188;
            goto LABEL_238;
          }
          v26 = v189;
LABEL_239:
          v190 = v116;
          if ( !v116 )
          {
            if ( v115 )
            {
              v133 = -1073741766;
              goto LABEL_278;
            }
            if ( !a17 )
            {
LABEL_277:
              v133 = -1073741772;
              goto LABEL_278;
            }
            v91 = v192;
            if ( v192 == ObpDirectoryObjectType )
              v92 = 8;
            else
              v92 = 4;
            v93 = v195;
            v94 = v199;
            if ( ObCheckCreateObjectAccess(
                   v195,
                   v92,
                   a18,
                   (int)v203,
                   0,
                   v199,
                   (int)&v193,
                   a15,
                   a16,
                   (int)v185,
                   v186,
                   v187,
                   v188,
                   SHIDWORD(v188),
                   v189,
                   v190,
                   v191,
                   v192,
                   v193,
                   v194,
                   v195) )
            {
              if ( *(_DWORD *)(v93 + 160) != -1
                && (v91 == MmSectionObjectType || v91 == ObpSymbolicLinkObjectType)
                && *(_DWORD *)(v93 + 160) != PsGetCurrentProcessSessionId()
                && !SeSinglePrivilegeCheck(SeCreateGlobalPrivilege, dword_92279C, v94, (int)&SeCreateGlobalPrivilege)
                && !((int (__fastcall *)(_DWORD *, bool))ObpIsUnsecureName)(v203, (v194 & 0x40) != 0) )
              {
                v133 = -1073741790;
                goto LABEL_278;
              }
              v95 = v198;
              v96 = ExAllocatePoolWithTag(1, v198, 1833853519);
              if ( v96 )
              {
                if ( !ObpInsertDirectoryEntry(v93, a17, v110) )
                {
                  ExFreePoolWithTag(v96);
                  goto LABEL_328;
                }
                memmove(v96, (int)v197, v95);
                v113 = (int)ObpInfoMaskToOffset;
                v174 = ObpInfoMaskToOffset[*(_BYTE *)(a17 - 10) & 3];
                v175 = a17 - 24 - v174;
                v176 = *(_DWORD *)(v175 + 8);
                if ( v176 )
                  ExFreePoolWithTag(v176);
                *(_DWORD *)(v175 + 8) = v96;
                *(_WORD *)(v175 + 4) = v95;
                *(_WORD *)(v175 + 6) = v95;
                v190 = a17;
                v133 = 0;
LABEL_258:
                v134 = v186;
LABEL_259:
                v73 = v200;
                if ( v200 )
                  v73 = ObfDereferenceObject(v200);
                if ( v196 )
                  v73 = ObfDereferenceDeviceMap((int)v196, v112, v113, v174);
                if ( v134 )
                  v73 = ObfDereferenceObject(v134);
                SeClearLearningModeObjectInformation(v73);
                if ( v133 < 0 )
                {
                  *a20 = 0;
                  __asm { POP.W           {R4-R11,PC} }
                }
                *a20 = v190;
LABEL_267:
                __asm { POP.W           {R4-R11,PC} }
              }
LABEL_328:
              v133 = -1073741670;
LABEL_278:
              v134 = v186;
            }
            else
            {
              v133 = v193;
              v134 = v186;
              if ( v193 >= 0 )
                v133 = -1073741772;
            }
LABEL_279:
            v174 = *(unsigned __int8 *)(v110 + 18);
            if ( *(_BYTE *)(v110 + 18) )
            {
              v177 = (int *)(*(_DWORD *)v110 + 148);
              __pld(v177);
              v178 = *v177;
              if ( (*v177 & 0xFFFFFFF0) <= 0x10 )
                v179 = 0;
              else
                v179 = v178 - 16;
              if ( (v178 & 2) != 0 )
                goto LABEL_128;
              __dmb(0xBu);
              do
                v180 = __ldrex((unsigned int *)v177);
              while ( v180 == v178 && __strex(v179, (unsigned int *)v177) );
              if ( v180 != v178 )
LABEL_128:
                ExfReleasePushLock(v177, v178);
              KeAbPostRelease((unsigned int)v177);
              v181 = *(_DWORD *)v110;
              *(_DWORD *)(v110 + 20) = -286387660;
              v182 = ObfDereferenceObject(v181);
              *(_DWORD *)v110 = 0;
              *(_BYTE *)(v110 + 18) = 0;
              *(_BYTE *)(v110 + 19) = 0;
              v112 = __mrc(15, 0, 13, 0, 3) & 0xFFFFFFC0;
              v174 = (__int16)(*(_WORD *)(v112 + 0x134) + 1);
              *(_WORD *)(v112 + 308) = v174;
              if ( !v174 )
              {
                v174 = *(_DWORD *)(v112 + 100);
                v113 = v112 + 100;
                if ( v174 != v112 + 100 )
                {
                  v174 = *(__int16 *)(v112 + 310);
                  if ( !*(_WORD *)(v112 + 310) )
                    KiCheckForKernelApcDelivery(v182);
                }
              }
            }
            v74 = *(_DWORD *)(v110 + 4);
            if ( v74 )
            {
              ObfDereferenceObject(v74);
              *(_DWORD *)(v110 + 4) = 0;
            }
            goto LABEL_259;
          }
        }
        while ( v115 );
        if ( v199
          && (*(_DWORD *)(a18 + 12) & 1) == 0
          && !((int (__fastcall *)(int, int, int))ObpCheckTraverseAccess)(v195, a18, a18) )
        {
          goto LABEL_31;
        }
        ObfDereferenceObject(v200);
        v116 = v190;
        v200 = 0;
        v70 = *(unsigned __int8 *)(v190 - 12);
        v191 = v190;
        v71 = *(int (__fastcall **)(int, int, int, char, int, int, unsigned __int16 *, int, int, int *))(ObTypeIndexTable[(unsigned __int8)((unsigned __int16)(v190 - 24) >> 8) ^ (unsigned __int8)ObHeaderCookie ^ v70] + 104);
        if ( !v71 )
        {
LABEL_244:
          v133 = ObReferenceObjectByPointer(v190, 0, v192, v201);
          goto LABEL_257;
        }
        if ( v71 == ObpParseSymbolicLink )
        {
          v114 = (_WORD *)HIDWORD(v188);
          v26 = v188;
          v115 = (unsigned __int16)v188;
        }
        else
        {
          if ( a17 )
            goto LABEL_244;
          v114 = (_WORD *)HIDWORD(v188);
          v26 = v188;
          v115 = (unsigned __int16)v188;
        }
      }
    }
    if ( !v111 )
      goto LABEL_267;
  }
  ObfDereferenceObject(v111);
  goto LABEL_267;
}
