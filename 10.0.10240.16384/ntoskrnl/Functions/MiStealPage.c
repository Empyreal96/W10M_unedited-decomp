// MiStealPage 
 
int __fastcall MiStealPage(int a1, int a2, int a3, int a4, _DWORD *a5)
{
  int v7; // r9
  int v8; // r10
  unsigned int v9; // r5
  unsigned int v10; // r0
  int v11; // r1
  unsigned int v12; // r1
  unsigned int v13; // r0
  int v14; // r2
  int v15; // r3
  int v16; // r0
  int v17; // r3
  unsigned int *v18; // r4
  unsigned int v19; // r1
  unsigned int v20; // r2
  unsigned int v21; // r7
  int v22; // r8
  int *v23; // r3
  unsigned int *v24; // lr
  unsigned __int8 *v25; // r3
  unsigned int v26; // r1
  unsigned int v27; // r0
  int v28; // r4
  unsigned int v29; // r1
  unsigned int v30; // r0
  int v31; // r0
  unsigned int v32; // r1
  unsigned int v33; // r0
  unsigned int v34; // r1
  unsigned int v35; // r10
  unsigned int v36; // r0
  int v37; // r1
  int v38; // r1
  int v39; // r2
  int v40; // r7
  int v41; // lr
  unsigned __int8 *v42; // r1
  unsigned int v43; // r2
  int v44; // r4
  unsigned int v45; // r1
  unsigned int v46; // r8
  unsigned int v47; // r5
  int v48; // r8
  unsigned __int8 *v49; // r4
  unsigned int v50; // r1
  unsigned int v51; // r2
  int v52; // r4
  unsigned int *v53; // r0
  unsigned int v54; // r1
  int v55; // r3
  int v56; // r8
  unsigned int *v57; // r6
  int v58; // r6
  int v59; // r0
  unsigned int v60; // r7
  int v61; // r5
  int v62; // r8
  int v63; // r2
  int v64; // r5
  unsigned int v65; // r4
  unsigned int v66; // r1
  int v67; // r4
  unsigned __int8 *v68; // r1
  unsigned int v69; // r2
  unsigned int *v70; // r2
  unsigned int v71; // r0
  int v72; // r5
  unsigned __int8 *v73; // r0
  unsigned int *v74; // r6
  int v75; // r0
  int v76; // r0
  int v77; // r5
  int v78; // r4
  unsigned __int8 *v79; // r1
  unsigned int v80; // r2
  unsigned int v81; // r1
  int v82; // r4
  unsigned int v83; // r2
  unsigned int v84; // r3
  int v85; // r5
  int v86; // r5
  int v87; // r4
  int v88; // r3
  unsigned int *v89; // r2
  unsigned int v90; // r0
  int v91; // r6
  int v92; // r1
  __int16 v93; // r3
  int v94; // r3
  int v95; // r2
  int v96; // r4
  unsigned __int8 *v97; // r1
  unsigned int v98; // r2
  unsigned int v100; // r2
  int v101; // r4
  unsigned int v102; // r3
  int v103; // r1
  int v104; // r0
  unsigned __int8 *v105; // r1
  unsigned int v106; // r2
  unsigned int v107; // r7
  int v108; // r3
  int v109; // r3
  unsigned int v110; // r1
  int v111; // r1
  int v112; // r2
  int v113; // r3
  unsigned int *v114; // r2
  unsigned int v115; // r0
  _DWORD *v116; // r0
  int v117; // lr
  unsigned int *v118; // r2
  unsigned int v119; // r0
  int v120; // r0
  unsigned int *v121; // r2
  unsigned int v122; // r0
  int v123; // r0
  unsigned int *v124; // r1
  int *v125; // r0
  int v126; // r4
  __int16 v127; // r3
  unsigned int *v128; // r4
  unsigned __int8 *v129; // r3
  unsigned int v130; // r1
  unsigned int v131; // r0
  int v132; // r0
  int v133; // r2
  int v134; // r0
  int v135; // r3
  unsigned int *v136; // r2
  unsigned int v137; // r0
  unsigned int *v138; // r2
  unsigned int v139; // r0
  int v140; // r3
  int v141; // r0
  unsigned int *v142; // r10
  unsigned int v143; // r7
  __int16 v144; // r3
  unsigned __int8 *v145; // r3
  unsigned int v146; // r1
  unsigned int v147; // r0
  int v148; // r4
  unsigned int v149; // r1
  unsigned int v150; // r0
  int v151; // r3
  unsigned int v152; // r0
  unsigned int v153; // r1
  int v154; // r0
  unsigned int *v155; // r2
  unsigned int v156; // r0
  int v157; // r0
  unsigned int *v158; // r2
  unsigned int v159; // r0
  unsigned int v160; // r2
  int v161; // r0
  int v162; // r1
  __int16 v163; // r3
  int v164; // r4
  unsigned int v165; // r3
  bool v166; // cc
  int v167; // r4
  unsigned int v168; // lr
  int v169; // r0
  unsigned __int8 *v170; // r1
  unsigned int v171; // r2
  int v172; // r2
  int v173; // r3
  int v174; // r4
  int v175; // r0
  unsigned int *v176; // r2
  unsigned int v177; // r4
  unsigned __int8 *v178; // r4
  unsigned int v179; // r2
  unsigned int v180; // r1
  unsigned int v181; // r2
  unsigned int v182; // r1
  unsigned int *v183; // r2
  unsigned int v184; // r0
  unsigned int *v185; // r4
  unsigned int v186; // r1
  unsigned int v187; // r1
  int v188; // r1
  unsigned __int8 *v189; // r6
  unsigned int v190; // r2
  unsigned int *v191; // r4
  unsigned __int8 *v192; // r3
  unsigned int v193; // r1
  int v194; // r9
  unsigned int v195; // r0
  unsigned int v196; // r1
  unsigned int *v197; // r2
  unsigned int v198; // r0
  unsigned int v199; // r1
  int v200; // r0
  __int16 v201; // r3
  unsigned __int8 *v202; // r1
  unsigned int v203; // r2
  int v204; // r3
  unsigned int v205; // r2
  unsigned int v206; // r0
  unsigned int v207; // r1
  int v208; // r3
  unsigned int v209; // r1
  int v210; // r3
  unsigned int v211; // r0
  unsigned int v212; // r1
  unsigned int v213; // r0
  unsigned int v214; // r1
  int v215; // r0
  int v216; // r1
  __int16 v217; // r3
  unsigned __int8 *v218; // r1
  unsigned int v219; // r2
  unsigned int v220; // r3
  unsigned int v221; // r2
  unsigned int *v222; // r4
  unsigned int v223; // r1
  int v224; // r0
  unsigned int *v225; // r1
  int *v226; // r0
  unsigned int *v227; // r2
  unsigned int v228; // r0
  unsigned __int8 *v229; // r1
  unsigned int v230; // r2
  unsigned int v231; // r3
  unsigned int v232; // r2
  int *v233; // r4
  _DWORD *v234; // r5
  unsigned int v235; // r7
  unsigned int *v236; // r2
  unsigned int v237; // r0
  int v238; // r3
  unsigned int *v239; // r2
  unsigned int v240; // r0
  unsigned int v241; // r4
  unsigned int v242; // r2
  int v243; // r0
  int v244; // r3
  int v245; // r4
  int v246; // r0
  unsigned int *v247; // r2
  unsigned int v248; // r0
  unsigned int *v249; // r2
  unsigned int v250; // r0
  unsigned int *v251; // r2
  unsigned int v252; // r0
  int v253; // r4
  unsigned __int8 *v254; // r1
  unsigned int v255; // r2
  unsigned int *v256; // r2
  unsigned int v257; // r0
  int v258; // r3
  int v259; // r0
  unsigned int v260; // r3
  unsigned int v261; // r3
  unsigned int v262; // r1
  unsigned __int8 *v263; // r4
  int v264; // r0
  unsigned int v265; // r2
  int v266; // r0
  int v267; // r0
  unsigned int v268; // r3
  int v269; // r3
  unsigned int v270; // r4
  int v271; // r1
  unsigned int v272; // r2
  unsigned int v273; // r3
  unsigned int *v274; // r2
  unsigned int v275; // r0
  unsigned int v276; // r1
  unsigned int v277; // r3
  int v278; // r1
  int v279; // r3
  unsigned int *v280; // r2
  unsigned int v281; // r0
  int v282; // r3
  unsigned int *v283; // r4
  unsigned int v284; // r1
  int v285; // r3
  unsigned int v286; // [sp+0h] [bp-230h]
  int v287; // [sp+0h] [bp-230h]
  unsigned int v288; // [sp+4h] [bp-22Ch]
  char v289[4]; // [sp+8h] [bp-228h] BYREF
  int v290; // [sp+Ch] [bp-224h]
  int v291; // [sp+10h] [bp-220h]
  int v292; // [sp+14h] [bp-21Ch]
  int v293; // [sp+18h] [bp-218h]
  int v294; // [sp+1Ch] [bp-214h]
  char *v295; // [sp+20h] [bp-210h]
  unsigned int v296; // [sp+24h] [bp-20Ch]
  unsigned int v297; // [sp+28h] [bp-208h]
  int v298; // [sp+2Ch] [bp-204h]
  int v299; // [sp+30h] [bp-200h] BYREF
  unsigned int v300; // [sp+34h] [bp-1FCh]
  unsigned int v301; // [sp+38h] [bp-1F8h]
  int v302; // [sp+3Ch] [bp-1F4h]
  unsigned int *v303; // [sp+40h] [bp-1F0h]
  int v304; // [sp+44h] [bp-1ECh]
  int v305; // [sp+48h] [bp-1E8h]
  int v306; // [sp+4Ch] [bp-1E4h]
  unsigned int v307; // [sp+50h] [bp-1E0h]
  unsigned int v308; // [sp+54h] [bp-1DCh]
  int v309; // [sp+58h] [bp-1D8h]
  int v310; // [sp+60h] [bp-1D0h] BYREF
  unsigned int *v311; // [sp+64h] [bp-1CCh]
  int v312; // [sp+68h] [bp-1C8h]
  int v313; // [sp+6Ch] [bp-1C4h]
  int v314; // [sp+70h] [bp-1C0h]
  int v315; // [sp+74h] [bp-1BCh]
  int v316; // [sp+78h] [bp-1B8h]
  int v317; // [sp+7Ch] [bp-1B4h]
  unsigned __int8 *v318; // [sp+80h] [bp-1B0h] BYREF
  unsigned int v319; // [sp+84h] [bp-1ACh]
  int v320; // [sp+88h] [bp-1A8h]
  _DWORD v321[3]; // [sp+90h] [bp-1A0h] BYREF
  _DWORD *v322; // [sp+9Ch] [bp-194h]
  _DWORD v323[6]; // [sp+A0h] [bp-190h] BYREF
  int v324; // [sp+B8h] [bp-178h]
  int v325; // [sp+BCh] [bp-174h]
  char v326[4]; // [sp+C0h] [bp-170h] BYREF
  int v327; // [sp+C4h] [bp-16Ch]
  int v328; // [sp+C8h] [bp-168h]
  unsigned int v329; // [sp+CCh] [bp-164h]
  int v330; // [sp+D0h] [bp-160h]
  _DWORD *v331; // [sp+D4h] [bp-15Ch]
  char v332[24]; // [sp+D8h] [bp-158h] BYREF
  int v333; // [sp+F0h] [bp-140h] BYREF
  char v334; // [sp+F4h] [bp-13Ch]
  char v335; // [sp+F5h] [bp-13Bh]
  int v336; // [sp+F8h] [bp-138h]
  int v337; // [sp+FCh] [bp-134h]
  int v338; // [sp+100h] [bp-130h]
  int v339; // [sp+104h] [bp-12Ch]
  _DWORD v340[42]; // [sp+188h] [bp-A8h] BYREF
  int vars4; // [sp+234h] [bp+4h]

  v305 = a4;
  v313 = a3;
  v322 = a5;
  v7 = a1;
  v320 = a1;
  __dmb(0xBu);
  v310 = 0;
  v311 = 0;
  v312 = 0;
  __dmb(0xBu);
  v8 = 0;
  v9 = 0;
  v321[0] = 0;
  v321[1] = 0;
  v321[2] = 0;
  v315 = 0;
  v291 = 0;
  v303 = 0;
  v295 = 0;
  v319 = 0;
  v299 = 0;
  v316 = 17;
  v302 = 17;
  v286 = 0;
  v296 = *(_DWORD *)(a1 + 4) | 0x80000000;
  v10 = v296 << 10;
  v288 = v296 << 10;
  v11 = (v7 - MmPfnDatabase) / 24;
  v293 = v11;
  v298 = -1;
  if ( a5 )
    *a5 = -1;
  v337 = 0;
  v338 = 0;
  v334 = 0;
  v335 = 0;
  v336 = 33;
  v339 = 0;
  v317 = 0;
  v300 = 0x3FFFFF;
  v307 = 0x20000;
  v301 = -1070596096;
  v333 = 1;
  v290 = 0x40000000;
  if ( v10 <= MmHighestUserAddress )
  {
    v35 = 0;
    goto LABEL_223;
  }
  if ( (*(_DWORD *)(v7 + 20) & 0xFFFFF) == v11 )
  {
    if ( !*(_DWORD *)(v313 + 12) )
      return 0;
    v35 = 8;
LABEL_223:
    v116 = (_DWORD *)MiGetTopLevelPfn(v7, 0);
    v117 = *v116;
    v294 = *v116;
    if ( v116 != (_DWORD *)v7 )
    {
      __dmb(0xBu);
      v118 = v116 + 3;
      do
        v119 = __ldrex(v118);
      while ( __strex(v119 & 0x7FFFFFFF, v118) );
    }
    v306 = 0;
    if ( v117 == *(_DWORD *)((__mrc(15, 0, 13, 0, 3) & 0xFFFFFFC0) + 0x74) )
    {
      __dmb(0xBu);
      v136 = (unsigned int *)(v7 + 12);
      do
        v137 = __ldrex(v136);
      while ( __strex(v137 & 0x7FFFFFFF, v136) );
      goto LABEL_237;
    }
    if ( !KeTryToAcquireInStackQueuedSpinLockAtDpcLevel(&dword_634980, &v310) )
      return 0;
    v306 = v294 + 492;
    v120 = MiPrepareAttachThread(v294, v294 + 492);
    __dmb(0xBu);
    if ( v120 )
    {
      v121 = (unsigned int *)(v7 + 12);
      do
        v122 = __ldrex(v121);
      while ( __strex(v122 & 0x7FFFFFFF, v121) );
      if ( (dword_682604 & 0x10000) != 0 )
      {
        KiReleaseQueuedSpinLockInstrumented(&v310, vars4);
      }
      else
      {
        v123 = v310;
        if ( !v310 )
        {
          v124 = v311;
          __dmb(0xBu);
          do
            v125 = (int *)__ldrex(v124);
          while ( v125 == &v310 && __strex(0, v124) );
          if ( v125 == &v310 )
            goto LABEL_237;
          v123 = KxWaitForLockChainValid(&v310);
        }
        v310 = 0;
        __dmb(0xBu);
        v158 = (unsigned int *)(v123 + 4);
        do
          v159 = __ldrex(v158);
        while ( __strex(v159 ^ 1, v158) );
      }
LABEL_237:
      KfLowerIrql(a2);
      v304 = 0;
      v292 = 0;
      v314 = 0;
      v126 = v294;
      if ( v306 )
        KiStackAttachProcess(v294, 1, v332);
      v107 = __mrc(15, 0, 13, 0, 3) & 0xFFFFFFC0;
      v127 = *(_WORD *)(v107 + 0x136);
      v297 = v107;
      *(_WORD *)(v107 + 310) = v127 - 1;
      v128 = (unsigned int *)(v126 + 492);
      v316 = KfRaiseIrql(2);
      if ( (dword_682604 & 0x210000) != 0 )
      {
        ExpAcquireSpinLockExclusiveAtDpcLevelInstrumented(v128);
      }
      else
      {
        v129 = (unsigned __int8 *)v128 + 3;
        do
          v130 = __ldrex(v129);
        while ( __strex(v130 | 0x80, v129) );
        __dmb(0xBu);
        if ( v130 >> 7 )
          ExpWaitForSpinLockExclusiveAndAcquire(v128);
        while ( 1 )
        {
          v131 = *v128;
          if ( (*v128 & ~v290) == 0x80000000 )
            break;
          if ( (v131 & v290) == 0 )
          {
            do
              v187 = __ldrex(v128);
            while ( v187 == v131 && __strex(v131 | v290, v128) );
            __dmb(0xBu);
          }
          __dmb(0xAu);
          __yield();
        }
      }
      if ( (v35 & 8) != 0 )
      {
        if ( (v35 & 1) != 0 )
        {
          v135 = *(_DWORD *)(v294 + 328);
          v304 = v135;
          if ( v135 )
          {
            if ( !ExTryAcquireAutoExpandPushLockExclusive(v135 + 4, 0) )
            {
              v304 = 0;
              goto LABEL_203;
            }
          }
        }
      }
      else
      {
        v132 = MiLocateAddress(v288);
        if ( !v132 )
          goto LABEL_203;
        v133 = *(_DWORD *)(v132 + 28) & 7;
        if ( ((1 << v133) & 0x15) == 0 )
        {
          if ( v133 != 6 )
            goto LABEL_203;
          v35 |= 0x10000u;
        }
      }
      if ( !MiSmallVaStillMapsFrame(v288, v293)
        || (*(_DWORD *)(v7 + 20) & 0x8000000) != 0
        || (v35 & 0x10000) != 0 && MiRotatedToFrameBuffer(v296) )
      {
LABEL_203:
        v36 = MiUnlockWorkingSetExclusive(v294 + 492, v316);
        if ( v304 )
          v36 = ExReleaseAutoExpandPushLockExclusive(v304 + 4, 0);
        v108 = (__int16)(*(_WORD *)(v107 + 310) + 1);
        *(_WORD *)(v107 + 310) = v108;
        if ( !v108 )
        {
          v94 = *(_DWORD *)(v107 + 100);
          v95 = v107 + 100;
LABEL_176:
          if ( v94 != v95 )
            KiCheckForKernelApcDelivery(v36);
          goto LABEL_178;
        }
        goto LABEL_178;
      }
      v37 = v294;
LABEL_252:
      v36 = 8;
LABEL_61:
      if ( !*(_DWORD *)(v313 + 12) )
      {
        if ( (*(_BYTE *)(v7 + 18) & 0x10) == 0 && (v35 & 0x20008) == 0 && (*(_DWORD *)v296 & 0x200) != 0 )
        {
          if ( (v35 & 0x400) != 0 )
          {
            v233 = (int *)(*(_DWORD *)(*(_DWORD *)((__mrc(15, 0, 13, 0, 3) & 0xFFFFFFC0) + 0x74) + 324) + 3248);
          }
          else if ( ((v35 | (v35 >> 5)) & 0x10) != 0 )
          {
            v233 = &dword_634E80;
          }
          else
          {
            v233 = (v35 & 0x40) != 0 ? &dword_634F00 : v37 + 492;
          }
          if ( (*(_BYTE *)(v7 + 19) & 8) == 0 )
          {
            v234 = (_DWORD *)v233[23];
            v36 = MiLocateWsle(v288, v233, *(_DWORD *)v7);
            v235 = v36;
            if ( v36 >= v234[1] )
            {
              if ( dword_634484
                && (*(_DWORD *)v296 & 0x10) != 0
                && (*(_DWORD *)(v234[9] * v36 + v234[63]) & 0xE00) != 3584 )
              {
                MiLogPageAccess(v233, v296);
              }
              v340[0] = 1;
              v340[1] = v235;
              v36 = MiFreeWsleList(v233, v340, 0);
              if ( !v36 )
                v315 = 2;
            }
          }
        }
        goto LABEL_168;
      }
      if ( v305 == -1 )
      {
        v38 = (MiPageToNode(v293, 0) << byte_6337F5) | dword_633814 & v293;
        v39 = 0;
      }
      else
      {
        v38 = v305 & ~dword_633814 | dword_633814 & v293;
        v39 = 16;
      }
      v36 = MiGetPage(&MiSystemPartition, v38, v39);
      v298 = v36;
      if ( v36 != -1 )
      {
        v40 = MmPfnDatabase + 24 * v36;
        v305 = v40;
        if ( v40 != v7 )
        {
          v41 = KfRaiseIrql(2);
          v287 = v41;
          v42 = (unsigned __int8 *)(v7 + 15);
          do
            v43 = __ldrex(v42);
          while ( __strex(v43 | 0x80, v42) );
          while ( 1 )
          {
            __dmb(0xBu);
            if ( !(v43 >> 7) )
              break;
            do
            {
              __dmb(0xAu);
              __yield();
              v238 = *(_DWORD *)(v7 + 12);
              __dmb(0xBu);
            }
            while ( (v238 & 0x80000000) != 0 );
            do
              v43 = __ldrex(v42);
            while ( __strex(v43 | 0x80, v42) );
          }
          if ( (MiFlags & 0x80000) != 0 && MiGetPagePrivilege(v7, 1, 0) == 1 )
            v35 |= 0x40000u;
          v44 = (v35 >> 5) & 1;
          if ( v44 )
          {
            if ( v288 < dword_63389C
              || *((_BYTE *)&MiState[2423]
                 + ((int)(((v288 >> 20) & 0xFFC) - (((unsigned int)dword_63389C >> 20) & 0xFFC)) >> 2)) != 5 )
            {
              __dmb(0xBu);
              v239 = (unsigned int *)(v7 + 12);
              do
                v240 = __ldrex(v239);
              while ( __strex(v240 & 0x7FFFFFFF, v239) );
              v157 = v41;
              goto LABEL_328;
            }
            if ( (*(_BYTE *)(v7 + 18) & 7) != 6 )
              goto LABEL_325;
            v46 = v296;
            if ( (*(_DWORD *)(v7 + 4) | 0x80000000) != v296 )
              goto LABEL_325;
            if ( !MiSmallVaStillMapsFrame(v288, v293) )
              goto LABEL_325;
            if ( (*(_BYTE *)(v7 + 19) & 0x10) != 0 )
              goto LABEL_325;
            v45 = *(_DWORD *)v296;
            v308 = v45;
            if ( (v45 & 0x100) != 0 || (v45 & 0x10) == 0 )
              goto LABEL_325;
          }
          else
          {
            v45 = 0;
            v46 = v296;
            v308 = 0;
          }
          if ( *(_WORD *)(v7 + 16) != 1 || ((*(_BYTE *)(v7 + 19) & 8) != 0 || !*(_DWORD *)v7) && (v35 & 0x20026) == 0 )
          {
LABEL_325:
            __dmb(0xBu);
            v155 = (unsigned int *)(v7 + 12);
            do
              v156 = __ldrex(v155);
            while ( __strex(v156 & 0x7FFFFFFF, v155) );
LABEL_327:
            v157 = v41;
LABEL_328:
            v36 = KfLowerIrql(v157);
            goto LABEL_601;
          }
          if ( (*(_BYTE *)(v7 + 18) & 7) != 6 )
          {
            __dmb(0xBu);
            v280 = (unsigned int *)(v7 + 12);
            do
              v281 = __ldrex(v280);
            while ( __strex(v281 & 0x7FFFFFFF, v280) );
            goto LABEL_327;
          }
          if ( !v44 )
          {
            v45 = *(_DWORD *)v46;
            v308 = *(_DWORD *)v46;
          }
          if ( (v35 & 0x100) == 0 && (*(_DWORD *)(v7 + 12) & 0x3FFFFFFFu) > 1 && v292 == 1 )
          {
            if ( (v35 & 0x10) == 0 || !KeTryToAcquireGuardedMutexAtDpc(dword_6825F4 + 4) )
              goto LABEL_325;
            v45 = v308;
            v35 |= 0x2008u;
          }
          if ( (v35 & v307) != 0 )
            goto LABEL_85;
          if ( (v35 & 0x20) != 0 )
          {
            v241 = v45;
            v319 = v45;
            if ( v46 < v301 || v46 > 0xC0300FFF )
            {
              v241 = v45 & 0xFFFFFFEF;
              v319 = v45 & 0xFFFFFFEF;
            }
            __dmb(0xBu);
            do
              v242 = __ldrex((unsigned int *)v46);
            while ( v242 == v45 && __strex(v241, (unsigned int *)v46) );
            __dmb(0xBu);
            if ( v242 != v45 )
              goto LABEL_325;
            v48 = 2;
            v292 = 2;
            v103 = 2;
            goto LABEL_195;
          }
          if ( (v35 & 8) != 0 && (v35 & 0x1000) == 0 || (v45 & 0x200) != 0 && (v35 & 0x40000) == 0 )
          {
LABEL_85:
            v47 = v288;
            v48 = v292;
            goto LABEL_86;
          }
          if ( (v35 & 0x1000) != 0 )
          {
            v100 = v45 | 0x200;
            if ( v290 + v46 <= v300 )
            {
              v165 = *(_DWORD *)v46;
              v101 = 0;
              __dmb(0xBu);
              *(_DWORD *)v46 = v100;
              if ( (v165 & 2) == 0 && (v45 & 2) != 0 )
                v101 = 1;
              v166 = v46 + 1070596096 > 0xFFF;
              goto LABEL_354;
            }
          }
          else
          {
            v100 = v45 & 0xFFFFFFFC | 0x400;
            v35 |= 0x80u;
            if ( v290 + v46 <= v300 )
            {
              v101 = 0;
              __dmb(0xBu);
              v102 = v301;
              *(_DWORD *)v46 = v100;
              if ( v46 < v102 )
              {
LABEL_192:
                if ( v101 == 1 )
                {
                  __dsb(0xFu);
                  __isb(0xFu);
                }
                goto LABEL_194;
              }
              v166 = v46 > 0xC0300FFF;
LABEL_354:
              if ( !v166 )
              {
                v243 = *(_DWORD *)(*(_DWORD *)((__mrc(15, 0, 13, 0, 3) & 0xFFFFFFC0) + 0x74) + 32);
                MiArmWriteConvertedHardwarePde(v243, v243 + 4 * (v46 & 0xFFF), v100);
              }
              goto LABEL_192;
            }
          }
          *(_DWORD *)v46 = v100;
LABEL_194:
          v48 = v292;
          v103 = v292;
LABEL_195:
          v47 = v288;
          KeFlushSingleTb(v288, v103);
LABEL_86:
          v49 = (unsigned __int8 *)(v40 + 15);
          v50 = *(unsigned __int8 *)(v7 + 18);
          v318 = (unsigned __int8 *)(v40 + 15);
          do
            v51 = __ldrex(v49);
          while ( __strex(v51 | 0x80, v49) );
          while ( 1 )
          {
            __dmb(0xBu);
            if ( !(v51 >> 7) )
              break;
            do
            {
              __dmb(0xAu);
              __yield();
              v244 = *(_DWORD *)(v40 + 12);
              __dmb(0xBu);
            }
            while ( (v244 & 0x80000000) != 0 );
            do
              v51 = __ldrex(v49);
            while ( __strex(v51 | 0x80, v49) );
          }
          MiFinalizePageAttribute(v40, v50 >> 6, 1);
          if ( (v35 & v307) != 0 )
          {
            v245 = (int)v303;
            v246 = KeAcquireInStackQueuedSpinLock(v303 + 29, v321);
            if ( v245 != MiVaIsPageFileHash(v246, v47) || (v52 = v293, !MiSmallVaStillMapsFrame(v47, v293)) )
            {
              KeReleaseInStackQueuedSpinLock(v321);
              __dmb(0xBu);
              v247 = (unsigned int *)(v40 + 12);
              do
                v248 = __ldrex(v247);
              while ( __strex(v248 & 0x7FFFFFFF, v247) );
              goto LABEL_325;
            }
          }
          else
          {
            v52 = v293;
          }
          MiCopyPfnEntry(v40, v7);
          if ( (*(_DWORD *)(v7 + 20) & 0xFFFFF) == v52 )
            *(_DWORD *)(v40 + 20) = *(_DWORD *)(v40 + 20) & 0xFFF00000 | v298 & 0xFFFFF;
          __dmb(0xBu);
          v53 = (unsigned int *)(v40 + 12);
          v303 = (unsigned int *)(v40 + 12);
          do
            v54 = __ldrex(v53);
          while ( __strex(v54 & 0x7FFFFFFF, v53) );
          if ( (v35 & 0x20020) != 0 )
          {
LABEL_102:
            v56 = (v35 >> 13) & 1;
            if ( !v56 )
            {
              v299 = 17;
              v309 = 0;
LABEL_104:
              v57 = (unsigned int *)(v40 + 12);
              goto LABEL_105;
            }
            v36 = MiLockProtoPoolPage(v288, v289);
            v167 = v36;
            v309 = v36;
            if ( !v36 )
              goto LABEL_600;
            if ( *(unsigned __int16 *)(v36 + 16) <= 2u )
            {
              v168 = v296;
              v169 = *(_DWORD *)v296;
              v308 = v169;
              if ( (v169 & 0x200) != 0 )
              {
                v52 = v293;
                v299 = (unsigned __int8)v289[0];
                goto LABEL_104;
              }
              v170 = (unsigned __int8 *)(v167 + 15);
              do
                v171 = __ldrex(v170);
              while ( __strex(v171 | 0x80, v170) );
              while ( 1 )
              {
                __dmb(0xBu);
                if ( !(v171 >> 7) )
                  break;
                do
                {
                  __dmb(0xAu);
                  __yield();
                  v258 = *(_DWORD *)(v167 + 12);
                  __dmb(0xBu);
                }
                while ( (v258 & 0x80000000) != 0 );
                do
                  v171 = __ldrex(v170);
                while ( __strex(v171 | 0x80, v170) );
              }
              if ( *(unsigned __int16 *)(v167 + 16) <= 2u )
              {
                v172 = v169 | 0x200;
                if ( v290 + v168 > v300 )
                {
                  *(_DWORD *)v168 = v172;
                }
                else
                {
                  v173 = *(_DWORD *)v168;
                  v174 = 0;
                  __dmb(0xBu);
                  *(_DWORD *)v168 = v172;
                  if ( (v173 & 2) == 0 && (v169 & 2) != 0 )
                    v174 = 1;
                  if ( v168 + 1070596096 <= 0xFFF )
                  {
                    v259 = *(_DWORD *)(*(_DWORD *)((__mrc(15, 0, 13, 0, 3) & 0xFFFFFFC0) + 0x74) + 32);
                    MiArmWriteConvertedHardwarePde(v259, v259 + 4 * (v168 & 0xFFF), v172);
                  }
                  if ( v174 == 1 )
                  {
                    __dsb(0xFu);
                    __isb(0xFu);
                  }
                  v167 = v309;
                }
                KeFlushSingleTb(v288, 1);
                v175 = MiCaptureDirtyBitToPfn(v167);
                __dmb(0xBu);
                v176 = (unsigned int *)(v167 + 12);
                do
                  v177 = __ldrex(v176);
                while ( __strex(v177 & 0x7FFFFFFF, v176) );
                if ( v175 )
                  MiReleasePageFileInfo(&MiSystemPartition, v175, 1);
                v178 = (unsigned __int8 *)(v40 + 15);
                do
                  v179 = __ldrex(v178);
                while ( __strex(v179 | 0x80, v178) );
                __dmb(0xBu);
                v57 = (unsigned int *)(v40 + 12);
                while ( v179 >> 7 )
                {
                  do
                  {
                    __dmb(0xAu);
                    __yield();
                    v260 = *v57;
                    __dmb(0xBu);
                  }
                  while ( (v260 & 0x80000000) != 0 );
                  do
                    v179 = __ldrex(v178);
                  while ( __strex(v179 | 0x80, v178) );
                  __dmb(0xBu);
                }
                MiCaptureDirtyBitToPfn(v40);
                __dmb(0xBu);
                do
                  v180 = __ldrex(v57);
                while ( __strex(v180 & 0x7FFFFFFF, v57) );
                v52 = v293;
                v299 = (unsigned __int8)v289[0];
LABEL_105:
                if ( !v56 && (v35 & 0x104) != 260 && ((v35 & 8) == 0 || (v35 & 2) != 0 || v292) )
                {
                  v72 = v287;
                  if ( v287 == 17 )
                  {
                    v78 = 0;
                  }
                  else
                  {
                    v78 = 4;
                    v79 = (unsigned __int8 *)(v40 + 15);
                    do
                      v80 = __ldrex(v79);
                    while ( __strex(v80 | 0x80, v79) );
                    while ( 1 )
                    {
                      __dmb(0xBu);
                      if ( !(v80 >> 7) )
                        break;
                      do
                      {
                        __dmb(0xAu);
                        __yield();
                        v261 = *v57;
                        __dmb(0xBu);
                      }
                      while ( (v261 & 0x80000000) != 0 );
                      do
                        v80 = __ldrex(v79);
                      while ( __strex(v80 | 0x80, v79) );
                    }
                  }
                  if ( (v35 & 0x40000) != 0 )
                    v78 |= 2u;
                  MiCopyPage(v298, v293, v313, v78);
                  if ( (v78 & 4) != 0 )
                  {
                    __dmb(0xBu);
                    do
                      v81 = __ldrex(v57);
                    while ( __strex(v81 & 0x7FFFFFFF, v57) );
                  }
                  v73 = (unsigned __int8 *)(v40 + 15);
                  v74 = (unsigned int *)(v40 + 12);
                  if ( (v35 & 0x20) == 0 && v287 != 17 )
                    *(_BYTE *)(v7 + 18) = *(_BYTE *)(v7 + 18) & 0xF8 | 5;
LABEL_145:
                  if ( (v35 & 2) != 0 && v294 && *(_DWORD *)(v294 + 248) == v293 )
                    *(_DWORD *)(v294 + 248) = v298;
                  v82 = v308 & 0xFFF | (v298 << 12);
                  if ( ((v35 >> 5) & 1) == 0 )
                  {
                    if ( (v35 & 0x8000) == 0 )
                    {
                      if ( (v35 & 0x80) == 0 && !v56 && ((v35 | (v35 >> 5)) & 0x10) != 0 )
                      {
                        do
                          v160 = __ldrex(v73);
                        while ( __strex(v160 | 0x80, v73) );
                        while ( 1 )
                        {
                          __dmb(0xBu);
                          if ( !(v160 >> 7) )
                            break;
                          do
                          {
                            __dmb(0xAu);
                            __yield();
                            v277 = *v74;
                            __dmb(0xBu);
                          }
                          while ( (v277 & 0x80000000) != 0 );
                          do
                            v160 = __ldrex(v73);
                          while ( __strex(v160 | 0x80, v73) );
                        }
                      }
                      v83 = v296;
                      if ( v290 + v296 > v300 )
                      {
                        *(_DWORD *)v296 = v82;
                      }
                      else
                      {
                        v84 = *(_DWORD *)v296;
                        v85 = 0;
                        __dmb(0xBu);
                        *(_DWORD *)v83 = v82;
                        if ( (v84 & 2) == 0 && (v82 & 2) != 0 )
                          v85 = 1;
                        if ( v83 >= v301 && v83 <= 0xC0300FFF )
                        {
                          v134 = *(_DWORD *)(*(_DWORD *)((__mrc(15, 0, 13, 0, 3) & 0xFFFFFFC0) + 0x74) + 32);
                          MiArmWriteConvertedHardwarePde(v134, v134 + 4 * (v83 & 0xFFF), v82);
                        }
                        if ( v85 == 1 )
                        {
                          __dsb(0xFu);
                          __isb(0xFu);
                        }
                      }
                    }
                    goto LABEL_156;
                  }
                  v270 = v319;
                  v271 = v319 & 0xFEF | (v298 << 12) | 0x10;
                  do
                    v272 = __ldrex(v73);
                  while ( __strex(v272 | 0x80, v73) );
                  while ( 1 )
                  {
                    __dmb(0xBu);
                    if ( !(v272 >> 7) )
                      break;
                    do
                    {
                      __dmb(0xAu);
                      __yield();
                      v273 = *v74;
                      __dmb(0xBu);
                    }
                    while ( (v273 & 0x80000000) != 0 );
                    do
                      v272 = __ldrex(v73);
                    while ( __strex(v272 | 0x80, v73) );
                  }
                  __dmb(0xBu);
                  v274 = (unsigned int *)v296;
                  do
                    v275 = __ldrex(v274);
                  while ( v275 == v270 && __strex(v271, v274) );
                  __dmb(0xBu);
                  do
                    v276 = __ldrex(v74);
                  while ( __strex(v276 & 0x7FFFFFFF, v74) );
                  if ( v275 == v270 )
                  {
                    *(_BYTE *)(v7 + 18) = *(_BYTE *)(v7 + 18) & 0xF8 | 5;
LABEL_156:
                    v86 = v292;
                    if ( (v35 & 0xA0) == 0 )
                      KeFlushSingleTb(v288, v292);
                    if ( v56 )
                    {
                      __dmb(0xBu);
                      do
                        v182 = __ldrex(v74);
                      while ( __strex(v182 & 0x7FFFFFFF, v74) );
                      __dmb(0xBu);
                      v183 = (unsigned int *)(v7 + 12);
                      do
                        v184 = __ldrex(v183);
                      while ( __strex(v184 & 0x7FFFFFFF, v183) );
                      MiUnlockProtoPoolPage(v309, v299);
                      v87 = 17;
                    }
                    else
                    {
                      if ( ((v35 | (v35 >> 5)) & 0x10) != 0 && (v35 & 0x80) == 0 )
                      {
                        KeFlushSingleTb(v288, v86);
                        __dmb(0xBu);
                        do
                          v110 = __ldrex(v74);
                        while ( __strex(v110 & 0x7FFFFFFF, v74) );
                      }
                      v87 = v287;
                    }
                    if ( (*(_BYTE *)(v7 + 23) & 7) == 3 )
                    {
                      v278 = 8;
                      if ( v87 != 17 )
                        v278 = 12;
                      MiClearPfnImageVerified(v7, v278);
                    }
                    if ( (v35 & v307) != 0 )
                      KeReleaseInStackQueuedSpinLock(v321);
                    if ( v87 == 17 )
                    {
                      v104 = KfRaiseIrql(2);
                      v105 = (unsigned __int8 *)(v7 + 15);
                      do
                        v106 = __ldrex(v105);
                      while ( __strex(v106 | 0x80, v105) );
                      while ( 1 )
                      {
                        __dmb(0xBu);
                        if ( !(v106 >> 7) )
                          break;
                        do
                        {
                          __dmb(0xAu);
                          __yield();
                          v279 = *(_DWORD *)(v7 + 12);
                          __dmb(0xBu);
                        }
                        while ( (v279 & 0x80000000) != 0 );
                        do
                          v106 = __ldrex(v105);
                        while ( __strex(v106 | 0x80, v105) );
                      }
                      v87 = v104;
                    }
                    v88 = *(_DWORD *)(v7 + 20);
                    *(_WORD *)(v7 + 16) = 0;
                    *(_DWORD *)(v7 + 20) = v88 & 0xF0FFFFFF;
                    *(_BYTE *)(v7 + 18) &= 0xC7u;
                    *(_BYTE *)(v7 + 19) &= 0xDFu;
                    *(_DWORD *)(v7 + 12) &= 0xC0000000;
                    __dmb(0xBu);
                    v89 = (unsigned int *)(v7 + 12);
                    do
                      v90 = __ldrex(v89);
                    while ( __strex(v90 & 0x7FFFFFFF, v89) );
                    v36 = KfLowerIrql(v87);
                    v315 = 1;
                    goto LABEL_168;
                  }
                  __dmb(0xBu);
                  v251 = (unsigned int *)(v7 + 12);
                  do
                    v252 = __ldrex(v251);
                  while ( __strex(v252 & 0x7FFFFFFF, v251) );
                  v36 = KfLowerIrql(v72);
LABEL_600:
                  *(_DWORD *)(v40 + 8) = 128;
LABEL_601:
                  v291 = v40;
                  if ( v40 )
                  {
                    v253 = KfRaiseIrql(2);
                    v254 = (unsigned __int8 *)(v40 + 15);
                    do
                      v255 = __ldrex(v254);
                    while ( __strex(v255 | 0x80, v254) );
                    while ( 1 )
                    {
                      __dmb(0xBu);
                      if ( !(v255 >> 7) )
                        break;
                      do
                      {
                        __dmb(0xAu);
                        __yield();
                        v282 = *(_DWORD *)(v40 + 12);
                        __dmb(0xBu);
                      }
                      while ( (v282 & 0x80000000) != 0 );
                      do
                        v255 = __ldrex(v254);
                      while ( __strex(v255 | 0x80, v254) );
                    }
                    *(_BYTE *)(v40 + 18) = *(_BYTE *)(v40 + 18) & 0xF8 | 5;
                    __dmb(0xBu);
                    v236 = (unsigned int *)(v40 + 12);
                    do
                      v237 = __ldrex(v236);
                    while ( __strex(v237 & 0x7FFFFFFF, v236) );
                    v36 = KfLowerIrql(v253);
                  }
                  goto LABEL_168;
                }
                v58 = v298;
                v59 = MiGetPteFromCopyList(v313, v298, v52);
                v60 = v59;
                v61 = v59 << 10;
                if ( v56 )
                {
                  v62 = MiReplacePageOfProtoPool(v288, v52, v58, v61);
                  goto LABEL_112;
                }
                v323[2] = v52;
                v323[3] = v58;
                v323[0] = v288;
                v323[1] = v59 << 10;
                v325 = 0;
                v323[4] = &v333;
                v62 = 1;
                v63 = *(_DWORD *)(v297 + 116);
                v323[5] = v297;
                v324 = v63;
                if ( (*(_DWORD *)(v7 + 20) & 0xFFFFF) == v52 )
                {
                  if ( (*(_BYTE *)(v63 + 607) & 8) == 0 )
                  {
                    __dmb(0xBu);
                    v188 = v294;
                    v189 = (unsigned __int8 *)(v294 + 736);
                    do
                      v190 = __ldrex(v189);
                    while ( __strex(v190 | 2, v189) );
                    __dmb(0xBu);
                    if ( !((unsigned __int8)(v190 & 2) >> 1) )
                    {
                      v191 = (unsigned int *)(v188 + 492);
                      v35 |= 0x8000u;
                      MiUnlockWorkingSetExclusive(v188 + 492, v316);
                      v327 = v324;
                      v326[1] = 0;
                      v326[0] = 0;
                      v330 = v61;
                      v328 = v298 << 12;
                      v329 = v288;
                      v331 = v323;
                      KeGenericCallDpc(KiSwapDirectoryTableBaseTarget, v326);
                      v316 = KfRaiseIrql(2);
                      if ( (dword_682604 & 0x210000) != 0 )
                      {
                        ExpAcquireSpinLockExclusiveAtDpcLevelInstrumented(v191);
                      }
                      else
                      {
                        v192 = (unsigned __int8 *)v191 + 3;
                        do
                          v193 = __ldrex(v192);
                        while ( __strex(v193 | 0x80, v192) );
                        __dmb(0xBu);
                        if ( v193 >> 7 )
                          ExpWaitForSpinLockExclusiveAndAcquire(v191);
                        v194 = v290;
                        while ( 1 )
                        {
                          v195 = *v191;
                          if ( (*v191 & ~v194) == 0x80000000 )
                            break;
                          if ( (v195 & v194) == 0 )
                          {
                            do
                              v262 = __ldrex(v191);
                            while ( v262 == v195 && __strex(v195 | v194, v191) );
                            __dmb(0xBu);
                          }
                          __dmb(0xAu);
                          __yield();
                        }
                        v7 = v320;
                      }
                      __dmb(0xBu);
                      do
                        v196 = __ldrex((unsigned int *)v189);
                      while ( __strex(v196 & 0xFFFFFFFD, (unsigned int *)v189) );
                      __dmb(0xBu);
LABEL_111:
                      if ( v325 >= 0 )
                        goto LABEL_112;
                      goto LABEL_636;
                    }
                  }
                }
                else
                {
                  if ( !v317 )
                  {
LABEL_110:
                    MiReplacePageTablePage(v323);
                    goto LABEL_111;
                  }
                  v263 = *(unsigned __int8 **)(v317 + 28);
                  v264 = KeAbPreAcquire(v263, 0, 1);
                  do
                    v265 = __ldrex(v263);
                  while ( __strex(v265 | 1, v263) );
                  __dmb(0xBu);
                  if ( (v265 & 1) == 0 )
                  {
                    if ( v264 )
                      *(_BYTE *)(v264 + 14) |= 1u;
                    v35 |= 0x4000u;
                    goto LABEL_110;
                  }
                  if ( v264 )
                    KeAbPostReleaseEx(v263, v264);
                  v317 = 0;
                }
LABEL_636:
                v62 = 0;
LABEL_112:
                v64 = v290;
                v65 = v300;
                if ( v60 + v290 > v300 )
                {
                  *(_DWORD *)v60 = 0;
                }
                else
                {
                  __dmb(0xBu);
                  v36 = v301;
                  *(_DWORD *)v60 = 0;
                  if ( v60 < v36 || v60 > 0xC0300FFF )
                    goto LABEL_114;
                  v266 = *(_DWORD *)(*(_DWORD *)((__mrc(15, 0, 13, 0, 3) & 0xFFFFFFC0) + 0x74) + 32);
                  MiArmWriteConvertedHardwarePde(v266, v266 + 4 * (v60 & 0xFFF), 0);
                }
                v36 = v301;
LABEL_114:
                v66 = v60 + 4;
                if ( v60 + 4 + v64 > v65 )
                {
                  *(_DWORD *)v66 = 0;
                }
                else
                {
                  __dmb(0xBu);
                  *(_DWORD *)v66 = 0;
                  if ( v66 >= v36 && v66 <= 0xC0300FFF )
                  {
                    v267 = *(_DWORD *)(*(_DWORD *)((__mrc(15, 0, 13, 0, 3) & 0xFFFFFFC0) + 0x74) + 32);
                    v36 = MiArmWriteConvertedHardwarePde(v267, v267 + 4 * (v66 & 0xFFF), 0);
                  }
                }
                if ( !v62 )
                {
                  if ( (v35 & 0x2000) != 0 )
                    v36 = MiUnlockProtoPoolPage(v309, v299);
                  v40 = v305;
                  goto LABEL_600;
                }
                v56 = (v35 >> 13) & 1;
                if ( v56 )
                {
                  *(_BYTE *)(v7 + 18) = *(_BYTE *)(v7 + 18) & 0xF8 | 5;
                  *(_DWORD *)(v7 + 12) = *(_DWORD *)(v7 + 12) & 0xC0000000 | 1;
                  v73 = v318;
                  do
                    v181 = __ldrex(v73);
                  while ( __strex(v181 | 0x80, v73) );
                  __dmb(0xBu);
                  v74 = v303;
                  while ( v181 >> 7 )
                  {
                    do
                    {
                      __dmb(0xAu);
                      __yield();
                      v268 = *v74;
                      __dmb(0xBu);
                    }
                    while ( (v268 & 0x80000000) != 0 );
                    do
                      v181 = __ldrex(v73);
                    while ( __strex(v181 | 0x80, v73) );
                    __dmb(0xBu);
                  }
                  v40 = v305;
                  v72 = v287;
                }
                else
                {
                  v67 = KfRaiseIrql(2);
                  v68 = (unsigned __int8 *)(v7 + 15);
                  do
                    v69 = __ldrex(v68);
                  while ( __strex(v69 | 0x80, v68) );
                  while ( 1 )
                  {
                    __dmb(0xBu);
                    if ( !(v69 >> 7) )
                      break;
                    do
                    {
                      __dmb(0xAu);
                      __yield();
                      v269 = *(_DWORD *)(v7 + 12);
                      __dmb(0xBu);
                    }
                    while ( (v269 & 0x80000000) != 0 );
                    do
                      v69 = __ldrex(v68);
                    while ( __strex(v69 | 0x80, v68) );
                  }
                  *(_BYTE *)(v7 + 18) = *(_BYTE *)(v7 + 18) & 0xF8 | 5;
                  *(_DWORD *)(v7 + 12) = *(_DWORD *)(v7 + 12) & 0xC0000000 | 1;
                  __dmb(0xBu);
                  v70 = (unsigned int *)(v7 + 12);
                  do
                    v71 = __ldrex(v70);
                  while ( __strex(v71 & 0x7FFFFFFF, v70) );
                  KfLowerIrql(v67);
                  v72 = 17;
                  v40 = v305;
                  v73 = v318;
                  v74 = v303;
                  v287 = 17;
                }
                goto LABEL_145;
              }
              __dmb(0xBu);
              v256 = (unsigned int *)(v167 + 12);
              do
                v257 = __ldrex(v256);
              while ( __strex(v257 & 0x7FFFFFFF, v256) );
            }
            v36 = MiUnlockProtoPoolPage(v167, (unsigned __int8)v289[0]);
            goto LABEL_600;
          }
          if ( (v35 & 0x2000) != 0 )
            goto LABEL_219;
          v55 = (v35 >> 3) & 1;
          if ( v55 )
          {
            if ( (v35 & 2) == 0 )
            {
LABEL_99:
              if ( (v35 & 0x1000) == 0 )
              {
                if ( !v55 || (v35 & 2) != 0 || v48 )
                {
                  if ( (v35 & 0x104) != 260 )
                    goto LABEL_102;
                  __dmb(0xBu);
                  v249 = (unsigned int *)(v7 + 12);
                  do
                    v250 = __ldrex(v249);
                  while ( __strex(v250 & 0x7FFFFFFF, v249) );
                }
                else
                {
                  __dmb(0xBu);
                  v138 = (unsigned int *)(v7 + 12);
                  do
                    v139 = __ldrex(v138);
                  while ( __strex(v139 & 0x7FFFFFFF, v138) );
                }
                goto LABEL_221;
              }
              goto LABEL_218;
            }
          }
          else if ( v48 )
          {
            goto LABEL_99;
          }
LABEL_218:
          *(_BYTE *)(v7 + 18) = *(_BYTE *)(v7 + 18) & 0xF8 | 5;
LABEL_219:
          __dmb(0xBu);
          v114 = (unsigned int *)(v7 + 12);
          do
            v115 = __ldrex(v114);
          while ( __strex(v115 & 0x7FFFFFFF, v114) );
LABEL_221:
          KfLowerIrql(v41);
          v287 = 17;
          goto LABEL_102;
        }
        v315 = 1;
      }
LABEL_168:
      if ( v292 )
      {
        if ( (v35 & 0x400) != 0 )
        {
          v161 = MiUnlockWorkingSetExclusive(v295, v302);
          if ( (v35 & 0x4000) != 0 )
          {
            v283 = *(unsigned int **)(v317 + 28);
            __dmb(0xBu);
            do
              v284 = __ldrex(v283);
            while ( __strex(v284 - 1, v283) );
            if ( (v284 & 2) != 0 && (v284 & 4) == 0 )
              ExfTryToWakePushLock(v283);
            v161 = KeAbPostRelease(v283);
          }
          v162 = v297;
          v163 = *(_WORD *)(v297 + 310) + 1;
          *(_WORD *)(v297 + 310) = v163;
          if ( !v163 && *(_DWORD *)(v162 + 100) != v162 + 100 )
            KiCheckForKernelApcDelivery(v161);
          v164 = v314;
          MmDetachSession(v314, v332);
          ObfDereferenceObjectWithTag(v164, 1953261124);
        }
        else
        {
          v91 = (int)v295;
          if ( v295 )
            v36 = MiUnlockWorkingSetExclusive(v295, v302);
          if ( (v35 & 0x2000) != 0 )
          {
            v185 = (unsigned int *)(dword_6825F4 + 4);
            *(_DWORD *)(dword_6825F4 + 8) = 0;
            __dmb(0xBu);
            do
              v186 = __ldrex(v185);
            while ( !v186 && __strex(1u, v185) );
            if ( v186 )
              ExpReleaseFastMutexContended(v185, v186, 1);
            v36 = KeAbPostRelease(v185);
          }
          if ( v91 )
          {
            v92 = v297;
            v93 = *(_WORD *)(v297 + 310) + 1;
            *(_WORD *)(v297 + 310) = v93;
            if ( !v93 )
            {
              v94 = *(_DWORD *)(v92 + 100);
              v95 = v92 + 100;
              goto LABEL_176;
            }
          }
        }
LABEL_178:
        v96 = v306;
        if ( v306 )
        {
          KiUnstackDetachProcess(v332, 1);
          MiAttachThreadDone(v96, v111, v112, v113);
        }
        if ( v291 )
          MiReleaseFreshPage(v291);
        KfRaiseIrql(2);
        v97 = (unsigned __int8 *)(v7 + 15);
        do
          v98 = __ldrex(v97);
        while ( __strex(v98 | 0x80, v97) );
        while ( 1 )
        {
          __dmb(0xBu);
          if ( !(v98 >> 7) )
            break;
          do
          {
            __dmb(0xAu);
            __yield();
            v285 = *(_DWORD *)(v7 + 12);
            __dmb(0xBu);
          }
          while ( (v285 & 0x80000000) != 0 );
          do
            v98 = __ldrex(v97);
          while ( __strex(v98 | 0x80, v97) );
        }
        v77 = v315;
        if ( v315 == 1 )
        {
          if ( v322 )
            *v322 = v298;
        }
        else
        {
          if ( (*(_BYTE *)(v7 + 18) & 7) != 6 )
            v77 = 2;
          if ( v77 == 2 )
            goto LABEL_695;
        }
        return v77;
      }
      v107 = v297;
      goto LABEL_203;
    }
    v222 = (unsigned int *)(v7 + 12);
    do
      v223 = __ldrex(v222);
    while ( __strex(v223 & 0x7FFFFFFF, v222) );
    if ( (dword_682604 & 0x10000) != 0 )
    {
      KiReleaseQueuedSpinLockInstrumented(&v310, vars4);
      goto LABEL_522;
    }
    v224 = v310;
    if ( !v310 )
    {
      v225 = v311;
      __dmb(0xBu);
      do
        v226 = (int *)__ldrex(v225);
      while ( v226 == &v310 && __strex(0, v225) );
      if ( v226 == &v310 )
      {
LABEL_522:
        v229 = (unsigned __int8 *)(v7 + 15);
        do
          v230 = __ldrex(v229);
        while ( __strex(v230 | 0x80, v229) );
        __dmb(0xBu);
        if ( v230 >> 7 )
        {
          do
          {
            do
            {
              __dmb(0xAu);
              __yield();
              v231 = *v222;
              __dmb(0xBu);
            }
            while ( (v231 & 0x80000000) != 0 );
            do
              v232 = __ldrex(v229);
            while ( __strex(v232 | 0x80, v229) );
            __dmb(0xBu);
          }
          while ( v232 >> 7 );
        }
        return 0;
      }
      v224 = KxWaitForLockChainValid(&v310);
    }
    v310 = 0;
    __dmb(0xBu);
    v227 = (unsigned int *)(v224 + 4);
    do
      v228 = __ldrex(v227);
    while ( __strex(v228 ^ 1, v227) );
    goto LABEL_522;
  }
  v12 = -1070596096;
  v13 = (((unsigned int)MmHighestUserAddress >> 20) & 0xFFC) - 1070596096;
  v14 = 0;
  do
  {
    if ( v296 >= v12 && v296 <= v13 )
    {
      v35 = 9;
      goto LABEL_223;
    }
    ++v14;
    v12 = ((v12 >> 10) & 0x3FFFFC) - v290;
    v13 = ((v13 >> 10) & 0x3FFFFC) - v290;
  }
  while ( !v14 );
  if ( v288 < dword_63389C )
    goto LABEL_12;
  v15 = *((unsigned __int8 *)&MiState[2423]
        + ((int)(((v288 >> 20) & 0xFFC) - (((unsigned int)dword_63389C >> 20) & 0xFFC)) >> 2));
  if ( v15 == 5 )
  {
    if ( !*(_DWORD *)(v313 + 12) )
      return 0;
    __dmb(0xBu);
    v197 = (unsigned int *)(v7 + 12);
    do
      v198 = __ldrex(v197);
    while ( __strex(v198 & 0x7FFFFFFF, v197) );
    KfLowerIrql(a2);
    v37 = 0;
    v306 = 0;
    v294 = 0;
    v304 = 0;
    v292 = 1;
    v35 = 32;
    v297 = __mrc(15, 0, 13, 0, 3) & 0xFFFFFFC0;
    v314 = 0;
    goto LABEL_252;
  }
  if ( v15 == 11 || v15 == 1 )
  {
LABEL_288:
    v141 = MiAttachToOwningSession(v7, a2, v332);
    v314 = v141;
    if ( !v141 )
      return 0;
    v142 = (unsigned int *)(*(_DWORD *)(v141 + 324) + 3248);
    v295 = (char *)v142;
    v143 = __mrc(15, 0, 13, 0, 3) & 0xFFFFFFC0;
    v144 = *(_WORD *)(v143 + 0x136);
    v297 = v143;
    *(_WORD *)(v143 + 310) = v144 - 1;
    v302 = KfRaiseIrql(2);
    if ( (dword_682604 & 0x210000) != 0 )
    {
      ExpAcquireSpinLockExclusiveAtDpcLevelInstrumented(v142);
    }
    else
    {
      v145 = (unsigned __int8 *)v142 + 3;
      do
        v146 = __ldrex(v145);
      while ( __strex(v146 | 0x80, v145) );
      __dmb(0xBu);
      if ( v146 >> 7 )
        ExpWaitForSpinLockExclusiveAndAcquire(v142);
      while ( 1 )
      {
        v147 = *v142;
        if ( (*v142 & ~v290) == 0x80000000 )
          break;
        if ( (v147 & v290) == 0 )
        {
          do
            v199 = __ldrex(v142);
          while ( v199 == v147 && __strex(v147 | v290, v142) );
          __dmb(0xBu);
        }
        __dmb(0xAu);
        __yield();
      }
    }
    v35 = 1024;
    if ( (dword_682604 & 0x210000) != 0 )
    {
      ExpAcquireSpinLockSharedAtDpcLevelInstrumented(&dword_6342C0);
    }
    else
    {
      v148 = dword_6342C0 & 0x7FFFFFFF;
      v149 = (dword_6342C0 & 0x7FFFFFFF) + 1;
      do
        v150 = __ldrex((unsigned int *)&dword_6342C0);
      while ( v150 == v148 && __strex(v149, (unsigned int *)&dword_6342C0) );
      __dmb(0xBu);
      if ( v150 != v148 )
        ExpWaitForSpinLockSharedAndAcquire(&dword_6342C0, v149);
    }
    if ( MiSmallVaStillMapsFrame(v288, -1) )
    {
      if ( v288 >= dword_63389C
        && ((v151 = *((unsigned __int8 *)&MiState[2423]
                    + ((int)(((v288 >> 20) & 0xFFC) - (((unsigned int)dword_63389C >> 20) & 0xFFC)) >> 2)),
             v151 == 11)
         || v151 == 1)
        || v290 + v288 <= v300
        && v288 << 10 >= dword_63389C
        && ((v208 = *((unsigned __int8 *)&MiState[2423]
                    + ((int)(((v288 >> 10) & 0xFFC) - (((unsigned int)dword_63389C >> 20) & 0xFFC)) >> 2)),
             v208 == 1)
         || v208 == 11) )
      {
        if ( MiSmallVaStillMapsFrame(v288, v293) == 1 )
        {
          v337 = 0;
          v333 = 2;
          v334 = 0;
          v335 = 0;
          v338 = 0;
          v336 = 33;
          v339 = 0;
          v35 = 3072;
        }
      }
      if ( (dword_682604 & 0x10000) != 0 )
      {
        ExpReleaseSpinLockSharedFromDpcLevelInstrumented(&dword_6342C0);
      }
      else
      {
        __dmb(0xBu);
        do
          v152 = __ldrex((unsigned int *)&dword_6342C0);
        while ( __strex(v152 & 0xBFFFFFFF, (unsigned int *)&dword_6342C0) );
        __dmb(0xBu);
        do
          v153 = __ldrex((unsigned int *)&dword_6342C0);
        while ( __strex(v153 - 1, (unsigned int *)&dword_6342C0) );
      }
      if ( (v35 & 0x800) != 0 && (*(_DWORD *)(v7 + 20) & 0x8000000) == 0 )
      {
        v154 = MiSessionWsMetaPage(v7);
        if ( v154 )
        {
          if ( v154 == 2 )
          {
            v35 |= 0x10Cu;
            v317 = *(_DWORD *)(*(_DWORD *)((__mrc(15, 0, 13, 0, 3) & 0xFFFFFFC0) + 0x74) + 324) + 8320;
          }
          else
          {
            v35 |= 0x10Au;
          }
        }
        v306 = 0;
        v304 = 0;
        v37 = 0;
        v292 = 1;
        v294 = 0;
        goto LABEL_252;
      }
    }
    else if ( (dword_682604 & 0x10000) != 0 )
    {
      ExpReleaseSpinLockSharedFromDpcLevelInstrumented(&dword_6342C0);
    }
    else
    {
      __dmb(0xBu);
      do
        v206 = __ldrex((unsigned int *)&dword_6342C0);
      while ( __strex(v206 & 0xBFFFFFFF, (unsigned int *)&dword_6342C0) );
      __dmb(0xBu);
      do
        v207 = __ldrex((unsigned int *)&dword_6342C0);
      while ( __strex(v207 - 1, (unsigned int *)&dword_6342C0) );
    }
    v200 = MiUnlockWorkingSetExclusive(v295, v302);
    v201 = *(_WORD *)(v143 + 310) + 1;
    *(_WORD *)(v143 + 310) = v201;
    if ( !v201 && *(_DWORD *)(v143 + 100) != v143 + 100 )
      KiCheckForKernelApcDelivery(v200);
    MmDetachSession(v314, v332);
    ObfDereferenceObjectWithTag(v314, 1953261124);
    KfRaiseIrql(2);
    v202 = (unsigned __int8 *)(v7 + 15);
    do
      v203 = __ldrex(v202);
    while ( __strex(v203 | 0x80, v202) );
    __dmb(0xBu);
    if ( v203 >> 7 )
    {
      do
      {
        do
        {
          __dmb(0xAu);
          __yield();
          v204 = *(_DWORD *)(v7 + 12);
          __dmb(0xBu);
        }
        while ( (v204 & 0x80000000) != 0 );
        do
          v205 = __ldrex(v202);
        while ( __strex(v205 | 0x80, v202) );
        __dmb(0xBu);
      }
      while ( v205 >> 7 );
    }
    if ( (*(_DWORD *)(v7 + 12) & v290) == 0 )
      return 2;
    return 0;
  }
LABEL_12:
  if ( v288 >= 0xC0000000 && v288 <= 0xC03FFFFF && v288 << 10 >= dword_63389C )
  {
    v140 = *((unsigned __int8 *)&MiState[2423]
           + ((int)(((v288 >> 10) & 0xFFC) - (((unsigned int)dword_63389C >> 20) & 0xFFC)) >> 2));
    if ( v140 == 1 || v140 == 11 )
      goto LABEL_288;
  }
  v16 = MiVaIsPageFileHash(v288, v288);
  v303 = (unsigned int *)v16;
  if ( v288 < dword_63389C )
  {
LABEL_17:
    if ( v16 )
    {
      v9 = v307;
      goto LABEL_21;
    }
    if ( v288 >= dword_63389C
      && *((_BYTE *)&MiState[2423] + ((int)(((v288 >> 20) & 0xFFC) - (((unsigned int)dword_63389C >> 20) & 0xFFC)) >> 2)) == 12
      || PsNtosImageBase
      && (v288 >= PsNtosImageBase && v288 < PsNtosImageEnd || v288 >= PsHalImageBase && v288 < PsHalImageEnd) )
    {
      v9 = 64;
      goto LABEL_21;
    }
    v75 = MiSystemWsMetaPage(v7, &v299);
    v8 = v299;
    if ( v75 )
    {
      v9 = 256;
      goto LABEL_21;
    }
  }
  else
  {
    v17 = *((unsigned __int8 *)&MiState[2423]
          + ((int)(((v288 >> 20) & 0xFFC) - (((unsigned int)dword_63389C >> 20) & 0xFFC)) >> 2));
    if ( v17 == 7 )
    {
      v9 = 512;
    }
    else
    {
      if ( v17 != 6 && v17 != 14 )
        goto LABEL_17;
      v9 = 16;
    }
LABEL_21:
    v286 = v9;
  }
  if ( ((v9 | ((v9 | ((v9 | ((v9 | (v9 >> 8)) >> 1)) >> 2)) >> 2)) & 0x10) == 0 )
  {
    v76 = MiPageInRange(v7, -1070592000, (((unsigned int)dword_633894 >> 10) & 0x3FFFFC) - v290, 0);
    if ( !v76 )
      return 0;
    if ( v76 == 2 )
    {
      v35 = v9 | 0xC;
    }
    else
    {
      v35 = v9 | 0xA;
      if ( v288 + 1069547520 <= 0x2000 )
        v35 = v9 | 0x100A;
    }
    goto LABEL_223;
  }
  if ( (!*(_DWORD *)v7 || (*(_BYTE *)(v7 + 19) & 8) != 0) && (v9 & 0x20100) == 0 )
    return 0;
  __dmb(0xBu);
  v18 = (unsigned int *)(v7 + 12);
  do
    v19 = __ldrex(v18);
  while ( __strex(v19 & 0x7FFFFFFF, v18) );
  KfLowerIrql(a2);
  v306 = 0;
  v294 = 0;
  v304 = 0;
  v292 = 1;
  v20 = __mrc(15, 0, 13, 0, 3) & 0xFFFFFFC0;
  v314 = 0;
  v21 = ((v9 | (v9 >> 5)) >> 4) & 1;
  v297 = v20;
  v22 = 0;
  if ( v21 )
  {
    v23 = &dword_634E80;
LABEL_30:
    v295 = (char *)v23;
  }
  else
  {
    if ( ((v9 | (v9 >> 11)) & 0x40) != 0 )
    {
      v23 = &dword_634F00;
      goto LABEL_30;
    }
    v295 = (char *)v8;
  }
  --*(_WORD *)(v20 + 310);
  v302 = KfRaiseIrql(2);
  if ( (dword_682604 & 0x210000) != 0 )
  {
    ExpAcquireSpinLockExclusiveAtDpcLevelInstrumented(v295);
  }
  else
  {
    v24 = (unsigned int *)v295;
    v25 = (unsigned __int8 *)(v295 + 3);
    do
      v26 = __ldrex(v25);
    while ( __strex(v26 | 0x80, v25) );
    __dmb(0xBu);
    if ( v26 >> 7 )
    {
      ExpWaitForSpinLockExclusiveAndAcquire(v295);
      v24 = (unsigned int *)v295;
    }
    while ( 1 )
    {
      v27 = *v24;
      if ( (*v24 & ~v290) == 0x80000000 )
        break;
      if ( (v27 & v290) == 0 )
      {
        do
          v209 = __ldrex(v24);
        while ( v209 == v27 && __strex(v27 | v290, v24) );
        __dmb(0xBu);
      }
      __dmb(0xAu);
      __yield();
    }
  }
  if ( (dword_682604 & 0x210000) != 0 )
  {
    ExpAcquireSpinLockSharedAtDpcLevelInstrumented(&dword_6342C0);
  }
  else
  {
    v28 = dword_6342C0 & 0x7FFFFFFF;
    v29 = (dword_6342C0 & 0x7FFFFFFF) + 1;
    do
      v30 = __ldrex((unsigned int *)&dword_6342C0);
    while ( v30 == v28 && __strex(v29, (unsigned int *)&dword_6342C0) );
    __dmb(0xBu);
    if ( v30 != v28 )
      ExpWaitForSpinLockSharedAndAcquire(&dword_6342C0, v29);
    v18 = (unsigned int *)(v7 + 12);
  }
  v31 = MiSmallVaStillMapsFrame(v288, -1);
  if ( !v31 )
    goto LABEL_484;
  if ( v21 )
  {
    if ( v288 >= dword_63389C )
    {
      v109 = *((unsigned __int8 *)&MiState[2423]
             + ((int)(((v288 >> 20) & 0xFFC) - (((unsigned int)dword_63389C >> 20) & 0xFFC)) >> 2));
      if ( v109 == 6 || v109 == 14 || v109 == 7 )
        goto LABEL_50;
    }
LABEL_484:
    v210 = dword_682604;
    goto LABEL_476;
  }
  if ( (v286 & v307) != 0 )
  {
    if ( MiVaIsPageFileHash(v31, v288) )
      goto LABEL_50;
    goto LABEL_484;
  }
  if ( (v286 & 0x40) == 0 )
  {
    v22 = MiSystemWsMetaPage(v7, &v318);
    if ( v22 && v318 == (unsigned __int8 *)v8 )
      goto LABEL_50;
    goto LABEL_484;
  }
  v32 = v288;
  if ( v288 >= dword_63389C )
  {
    if ( *((_BYTE *)&MiState[2423] + ((int)(((v288 >> 20) & 0xFFC) - (((unsigned int)dword_63389C >> 20) & 0xFFC)) >> 2)) == 12 )
      goto LABEL_50;
    v32 = v288;
  }
  if ( PsNtosImageBase
    && (v32 >= PsNtosImageBase && v32 < PsNtosImageEnd || v32 >= PsHalImageBase && v32 < PsHalImageEnd) )
  {
LABEL_50:
    if ( MiSmallVaStillMapsFrame(v288, v293) )
    {
      if ( (dword_682604 & 0x10000) != 0 )
      {
        ExpReleaseSpinLockSharedFromDpcLevelInstrumented(&dword_6342C0);
      }
      else
      {
        __dmb(0xBu);
        do
          v33 = __ldrex((unsigned int *)&dword_6342C0);
        while ( __strex(v33 & 0xBFFFFFFF, (unsigned int *)&dword_6342C0) );
        __dmb(0xBu);
        do
          v34 = __ldrex((unsigned int *)&dword_6342C0);
        while ( __strex(v34 - 1, (unsigned int *)&dword_6342C0) );
      }
      v35 = v286;
      if ( ((v286 >> 8) & 1) != 0 )
      {
        v36 = 8;
        if ( v22 == 2 )
          v35 = v286 | 0xC;
        else
          v35 = v286 | 0xA;
        goto LABEL_60;
      }
      if ( (v286 & v307) != 0 )
      {
        v37 = 0;
        goto LABEL_252;
      }
      v36 = 8;
      if ( (*(_BYTE *)(v7 + 19) & 8) == 0 && *(_DWORD *)v7 )
      {
LABEL_60:
        v37 = 0;
        goto LABEL_61;
      }
    }
    else
    {
      if ( (dword_682604 & 0x10000) != 0 )
      {
        ExpReleaseSpinLockSharedFromDpcLevelInstrumented(&dword_6342C0);
      }
      else
      {
        __dmb(0xBu);
        do
          v213 = __ldrex((unsigned int *)&dword_6342C0);
        while ( __strex(v213 & 0xBFFFFFFF, (unsigned int *)&dword_6342C0) );
        __dmb(0xBu);
        do
          v214 = __ldrex((unsigned int *)&dword_6342C0);
        while ( __strex(v214 - 1, (unsigned int *)&dword_6342C0) );
      }
      if ( !v21 )
        goto LABEL_482;
    }
    v77 = 0;
    goto LABEL_500;
  }
  v210 = dword_682604;
LABEL_476:
  if ( (v210 & 0x10000) != 0 )
  {
    ExpReleaseSpinLockSharedFromDpcLevelInstrumented(&dword_6342C0);
  }
  else
  {
    __dmb(0xBu);
    do
      v211 = __ldrex((unsigned int *)&dword_6342C0);
    while ( __strex(v211 & 0xBFFFFFFF, (unsigned int *)&dword_6342C0) );
    __dmb(0xBu);
    do
      v212 = __ldrex((unsigned int *)&dword_6342C0);
    while ( __strex(v212 - 1, (unsigned int *)&dword_6342C0) );
  }
LABEL_482:
  v77 = 2;
LABEL_500:
  v215 = MiUnlockWorkingSetExclusive(v295, v302);
  v216 = v297;
  v217 = *(_WORD *)(v297 + 310) + 1;
  *(_WORD *)(v297 + 310) = v217;
  if ( !v217 && *(_DWORD *)(v216 + 100) != v216 + 100 )
    KiCheckForKernelApcDelivery(v215);
  KfRaiseIrql(2);
  v218 = (unsigned __int8 *)(v7 + 15);
  do
    v219 = __ldrex(v218);
  while ( __strex(v219 | 0x80, v218) );
  __dmb(0xBu);
  if ( v219 >> 7 )
  {
    do
    {
      do
      {
        __dmb(0xAu);
        __yield();
        v220 = *v18;
        __dmb(0xBu);
      }
      while ( (v220 & 0x80000000) != 0 );
      do
        v221 = __ldrex(v218);
      while ( __strex(v221 | 0x80, v218) );
      __dmb(0xBu);
    }
    while ( v221 >> 7 );
  }
LABEL_695:
  if ( (*(_DWORD *)(v7 + 12) & v290) != 0 )
    return 0;
  return v77;
}
